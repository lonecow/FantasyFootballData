!function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){(function(e){!function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof n&&"object"==typeof t)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function t(e){return function(){return Y.apply(e,arguments)}}function n(e){return e===Object(e)}function o(e){return"[object StopIteration]"===ne(e)||e instanceof q}function r(e,t){if(M&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(oe)){for(var n=[],o=t;o;o=o.source)o.stack&&n.unshift(o.stack);n.unshift(e.stack);var r=n.join("\n"+oe+"\n");e.stack=i(r)}}function i(e){for(var t=e.split("\n"),n=[],o=0;o<t.length;++o){var r=t[o];c(r)||s(r)||!r||n.push(r)}return n.join("\n")}function s(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var o=/.*@(.+):(\d+)$/.exec(e);return o?[o[1],Number(o[2])]:void 0}function c(e){var t=a(e);if(!t)return!1;var n=t[0],o=t[1];return n===V&&o>=W&&ae>=o}function u(){if(M)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],o=a(n);if(!o)return;return V=o[0],o[1]}}function l(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function d(e){return e instanceof h?e:y(e)?k(e):O(e)}function f(){function e(e){t=e,i.source=e,X(n,function(t,n){z(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,o=void 0}var t,n=[],o=[],r=J(f.prototype),i=J(h.prototype);if(i.promiseDispatch=function(e,r,i){var s=Z(arguments);n?(n.push(s),"when"===r&&i[1]&&o.push(i[1])):z(function(){t.promiseDispatch.apply(t,s)})},i.valueOf=function(){if(n)return i;var e=v(t);return b(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},d.longStackSupport&&M)try{throw new Error}catch(s){i.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return r.promise=i,r.resolve=function(n){t||e(d(n))},r.fulfill=function(n){t||e(O(n))},r.reject=function(n){t||e(T(n))},r.notify=function(e){t||X(o,function(t,n){z(function(){n(e)})},void 0)},r}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=f();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function g(e){return p(function(t,n){for(var o=0,r=e.length;r>o;o++)d(e[o]).then(t,n)})}function h(e,t,n){void 0===t&&(t=function(e){return T(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var o=J(h.prototype);if(o.promiseDispatch=function(n,r,i){var s;try{s=e[r]?e[r].apply(o,i):t.call(o,r,i)}catch(a){s=T(a)}n&&n(s)},o.inspect=n,n){var r=n();"rejected"===r.state&&(o.exception=r.reason),o.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?o:e.value}}return o}function m(e,t,n,o){return d(e).then(t,n,o)}function v(e){if(b(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function b(e){return n(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function y(e){return n(e)&&"function"==typeof e.then}function I(e){return b(e)&&"pending"===e.inspect().state}function E(e){return!b(e)||"fulfilled"===e.inspect().state}function w(e){return b(e)&&"rejected"===e.inspect().state}function _(){re.length=0,ie.length=0,se||(se=!0)}function S(e,t){se&&(ie.push(e),re.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t))}function N(e){if(se){var t=Q(ie,e);-1!==t&&(ie.splice(t,1),re.splice(t,1))}}function T(e){var t=h({when:function(t){return t&&N(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return S(t,e),t}function O(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return te(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function k(e){var t=f();return z(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function A(e){return h({isDef:function(){}},function(t,n){return j(e,t,n)},function(){return d(e).inspect()})}function D(e,t,n){return d(e).spread(t,n)}function L(e){return function(){function t(e,t){var s;if("undefined"==typeof StopIteration){try{s=n[e](t)}catch(a){return T(a)}return s.done?d(s.value):m(s.value,r,i)}try{s=n[e](t)}catch(a){return o(a)?d(a.value):T(a)}return m(s,r,i)}var n=e.apply(this,arguments),r=t.bind(t,"next"),i=t.bind(t,"throw");return r()}}function R(e){d.done(d.async(e)())}function C(e){throw new q(e)}function x(e){return function(){return D([this,P(arguments)],function(t,n){return e.apply(t,n)})}}function j(e,t,n){return d(e).dispatch(t,n)}function P(e){return m(e,function(e){var t=0,n=f();return X(e,function(o,r,i){var s;b(r)&&"fulfilled"===(s=r.inspect()).state?e[i]=s.value:(++t,m(r,function(o){e[i]=o,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:i,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function B(e){return m(e,function(e){return e=$(e,d),m(P($(e,function(e){return m(e,K,K)})),function(){return e})})}function U(e){return d(e).allSettled()}function G(e,t){return d(e).then(void 0,void 0,t)}function F(e,t){return d(e).nodeify(t)}var M=!1;try{throw new Error}catch(H){M=!!H.stack}var V,q,W=u(),K=function(){},z=function(){function t(){for(;n.next;){n=n.next;var e=n.task;n.task=void 0;var o=n.domain;o&&(n.domain=void 0,o.enter());try{e()}catch(i){if(s)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),i;setTimeout(function(){throw i},0)}o&&o.exit()}r=!1}var n={task:void 0,next:null},o=n,r=!1,i=void 0,s=!1;if(z=function(t){o=o.next={task:t,domain:s&&e.domain,next:null},r||(r=!0,i())},"undefined"!=typeof e&&e.nextTick)s=!0,i=function(){e.nextTick(t)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){i=c,a.port1.onmessage=t,t()};var c=function(){a.port2.postMessage(0)};i=function(){setTimeout(t,0),c()}}else i=function(){setTimeout(t,0)};return z}(),Y=Function.call,Z=t(Array.prototype.slice),X=t(Array.prototype.reduce||function(e,t){var n=0,o=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=o)throw new TypeError}for(;o>n;n++)n in this&&(t=e(t,this[n],n));return t}),Q=t(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),$=t(Array.prototype.map||function(e,t){var n=this,o=[];return X(n,function(r,i,s){o.push(e.call(t,i,s,n))},void 0),o}),J=Object.create||function(e){function t(){}return t.prototype=e,new t},ee=t(Object.prototype.hasOwnProperty),te=Object.keys||function(e){var t=[];for(var n in e)ee(e,n)&&t.push(n);return t},ne=t(Object.prototype.toString);q="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var oe="From previous event:";d.resolve=d,d.nextTick=z,d.longStackSupport=!1,d.defer=f,f.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(arguments.length>2?Z(arguments,1):n)}},d.Promise=p,d.promise=p,p.race=g,p.all=P,p.reject=T,p.resolve=d,d.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},d.join=function(e,t){return d(e).join(t)},h.prototype.join=function(e){return d([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},d.race=g,h.prototype.race=function(){return this.then(d.race)},d.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,n){function o(t){try{return"function"==typeof e?e(t):t}catch(n){return T(n)}}function i(e){if("function"==typeof t){r(e,a);try{return t(e)}catch(n){return T(n)}}return T(e)}function s(e){return"function"==typeof n?n(e):e}var a=this,c=f(),u=!1;return z(function(){a.promiseDispatch(function(e){u||(u=!0,c.resolve(o(e)))},"when",[function(e){u||(u=!0,c.resolve(i(e)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=s(e)}catch(o){if(n=!0,!d.onerror)throw o;d.onerror(o)}n||c.notify(t)}]),c.promise},d.when=m,h.prototype.thenResolve=function(e){return this.then(function(){return e})},d.thenResolve=function(e,t){return d(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},d.thenReject=function(e,t){return d(e).thenReject(t)},d.nearer=v,d.isPromise=b,d.isPromiseAlike=y,d.isPending=I,h.prototype.isPending=function(){return"pending"===this.inspect().state},d.isFulfilled=E,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},d.isRejected=w,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var re=[],ie=[],se=!0;d.resetUnhandledRejections=_,d.getUnhandledReasons=function(){return re.slice()},d.stopUnhandledRejectionTracking=function(){_(),se=!1},_(),d.reject=T,d.fulfill=O,d.master=A,d.spread=D,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},d.async=L,d.spawn=R,d["return"]=C,d.promised=x,d.dispatch=j,h.prototype.dispatch=function(e,t){var n=this,o=f();return z(function(){n.promiseDispatch(o.resolve,e,t)}),o.promise},d.get=function(e,t){return d(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},d.set=function(e,t,n){return d(e).dispatch("set",[t,n])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},d.del=d["delete"]=function(e,t){return d(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},d.mapply=d.post=function(e,t,n){return d(e).dispatch("post",[t,n])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},d.send=d.mcall=d.invoke=function(e,t){return d(e).dispatch("post",[t,Z(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,Z(arguments,1)])},d.fapply=function(e,t){return d(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},d["try"]=d.fcall=function(e){return d(e).dispatch("apply",[void 0,Z(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,Z(arguments)])},d.fbind=function(e){var t=d(e),n=Z(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(Z(arguments))])}},h.prototype.fbind=function(){var e=this,t=Z(arguments);return function(){return e.dispatch("apply",[this,t.concat(Z(arguments))])}},d.keys=function(e){return d(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},d.all=P,h.prototype.all=function(){return P(this)},d.allResolved=l(B,"allResolved","allSettled"),h.prototype.allResolved=function(){return B(this)},d.allSettled=U,h.prototype.allSettled=function(){return this.then(function(e){return P($(e,function(e){function t(){return e.inspect()}return e=d(e),e.then(t,t)}))})},d.fail=d["catch"]=function(e,t){return d(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},d.progress=G,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},d.fin=d["finally"]=function(e,t){return d(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=d(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},d.done=function(e,t,n,o){return d(e).done(t,n,o)},h.prototype.done=function(t,n,o){var i=function(e){z(function(){if(r(e,s),!d.onerror)throw e;d.onerror(e)})},s=t||n||o?this.then(t,n,o):this;"object"==typeof e&&e&&e.domain&&(i=e.domain.bind(i)),s.then(void 0,i)},d.timeout=function(e,t,n){return d(e).timeout(t,n)},h.prototype.timeout=function(e,t){var n=f(),o=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(o),n.resolve(e)},function(e){clearTimeout(o),n.reject(e)},n.notify),n.promise},d.delay=function(e,t){return void 0===t&&(t=e,e=void 0),d(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var n=f();return setTimeout(function(){n.resolve(t)},e),n.promise})},d.nfapply=function(e,t){return d(e).nfapply(t)},h.prototype.nfapply=function(e){var t=f(),n=Z(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},d.nfcall=function(e){var t=Z(arguments,1);return d(e).nfapply(t)},h.prototype.nfcall=function(){var e=Z(arguments),t=f();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},d.nfbind=d.denodeify=function(e){var t=Z(arguments,1);return function(){var n=t.concat(Z(arguments)),o=f();return n.push(o.makeNodeResolver()),d(e).fapply(n).fail(o.reject),o.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=Z(arguments);return e.unshift(this),d.denodeify.apply(void 0,e)},d.nbind=function(e,t){var n=Z(arguments,2);return function(){function o(){return e.apply(t,arguments)}var r=n.concat(Z(arguments)),i=f();return r.push(i.makeNodeResolver()),d(o).fapply(r).fail(i.reject),i.promise}},h.prototype.nbind=function(){var e=Z(arguments,0);return e.unshift(this),d.nbind.apply(void 0,e)},d.nmapply=d.npost=function(e,t,n){return d(e).npost(t,n)},h.prototype.nmapply=h.prototype.npost=function(e,t){var n=Z(t||[]),o=f();return n.push(o.makeNodeResolver()),this.dispatch("post",[e,n]).fail(o.reject),o.promise},d.nsend=d.nmcall=d.ninvoke=function(e,t){var n=Z(arguments,2),o=f();return n.push(o.makeNodeResolver()),d(e).dispatch("post",[t,n]).fail(o.reject),o.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=Z(arguments,1),n=f();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},d.nodeify=F,h.prototype.nodeify=function(e){return e?void this.then(function(t){z(function(){e(null,t)})},function(t){z(function(){e(t)})}):this};var ae=u();return d})}).call(this,e("_process"))},{_process:4}],2:[function(e,t,n){"use strict";var o={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};"undefined"!=typeof t&&t.exports&&(t.exports=o),"function"==typeof define&&define([],function(){return o}),o.cipher.aes=function(e){this._tables[0][0][0]||this._precompute();var t,n,r,i,s,a=this._tables[0][4],c=this._tables[1],u=e.length,l=1;if(4!==u&&6!==u&&8!==u)throw new o.exception.invalid("invalid aes key size");for(this._key=[i=e.slice(0),s=[]],t=u;4*u+28>t;t++)r=i[t-1],(t%u===0||8===u&&t%u===4)&&(r=a[r>>>24]<<24^a[r>>16&255]<<16^a[r>>8&255]<<8^a[255&r],t%u===0&&(r=r<<8^r>>>24^l<<24,l=l<<1^283*(l>>7))),i[t]=i[t-u]^r;for(n=0;t;n++,t--)r=i[3&n?t:t-4],s[n]=4>=t||4>n?r:c[0][a[r>>>24]]^c[1][a[r>>16&255]]^c[2][a[r>>8&255]]^c[3][a[255&r]]},o.cipher.aes.prototype={encrypt:function(e){return this._crypt(e,0)},decrypt:function(e){return this._crypt(e,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var e,t,n,o,r,i,s,a,c,u=this._tables[0],l=this._tables[1],d=u[4],f=l[4],p=[],g=[];for(e=0;256>e;e++)g[(p[e]=e<<1^283*(e>>7))^e]=e;for(t=n=0;!d[t];t^=o||1,n=g[n]||1)for(s=n^n<<1^n<<2^n<<3^n<<4,s=s>>8^255&s^99,d[t]=s,f[s]=t,i=p[r=p[o=p[t]]],c=16843009*i^65537*r^257*o^16843008*t,a=257*p[s]^16843008*s,e=0;4>e;e++)u[e][t]=a=a<<24^a>>>8,l[e][s]=c=c<<24^c>>>8;for(e=0;5>e;e++)u[e]=u[e].slice(0),l[e]=l[e].slice(0)},_crypt:function(e,t){if(4!==e.length)throw new o.exception.invalid("invalid aes block size");var n,r,i,s,a=this._key[t],c=e[0]^a[0],u=e[t?3:1]^a[1],l=e[2]^a[2],d=e[t?1:3]^a[3],f=a.length/4-2,p=4,g=[0,0,0,0],h=this._tables[t],m=h[0],v=h[1],b=h[2],y=h[3],I=h[4];for(s=0;f>s;s++)n=m[c>>>24]^v[u>>16&255]^b[l>>8&255]^y[255&d]^a[p],r=m[u>>>24]^v[l>>16&255]^b[d>>8&255]^y[255&c]^a[p+1],i=m[l>>>24]^v[d>>16&255]^b[c>>8&255]^y[255&u]^a[p+2],d=m[d>>>24]^v[c>>16&255]^b[u>>8&255]^y[255&l]^a[p+3],p+=4,c=n,u=r,l=i;for(s=0;4>s;s++)g[t?3&-s:s]=I[c>>>24]<<24^I[u>>16&255]<<16^I[l>>8&255]<<8^I[255&d]^a[p++],n=c,c=u,u=l,l=d,d=n;return g}},o.bitArray={bitSlice:function(e,t,n){return e=o.bitArray._shiftRight(e.slice(t/32),32-(31&t)).slice(1),void 0===n?e:o.bitArray.clamp(e,n-t)},extract:function(e,t,n){var o,r=Math.floor(-t-n&31);return o=-32&(t+n-1^t)?e[t/32|0]<<32-r^e[t/32+1|0]>>>r:e[t/32|0]>>>r,o&(1<<n)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var n=e[e.length-1],r=o.bitArray.getPartial(n);return 32===r?e.concat(t):o.bitArray._shiftRight(t,r,0|n,e.slice(0,e.length-1))},bitLength:function(e){var t,n=e.length;return 0===n?0:(t=e[n-1],32*(n-1)+o.bitArray.getPartial(t))},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t=31&t,n>0&&t&&(e[n-1]=o.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,n){return 32===e?t:(n?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(o.bitArray.bitLength(e)!==o.bitArray.bitLength(t))return!1;var n,r=0;for(n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r},_shiftRight:function(e,t,n,r){var i,s,a=0;for(void 0===r&&(r=[]);t>=32;t-=32)r.push(n),n=0;if(0===t)return r.concat(e);for(i=0;i<e.length;i++)r.push(n|e[i]>>>t),n=e[i]<<32-t;return a=e.length?e[e.length-1]:0,s=o.bitArray.getPartial(a),r.push(o.bitArray.partial(t+s&31,t+s>32?n:r.pop(),1)),r},_xor4:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,n,o=65280;for(t=0;t<e.length;++t)n=e[t],e[t]=n>>>24|n>>>8&o|(n&o)<<8|n<<24;return e}},o.codec.utf8String={fromBits:function(e){var t,n,r="",i=o.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(n=e[t/4]),r+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(r))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,n=[],r=0;for(t=0;t<e.length;t++)r=r<<8|e.charCodeAt(t),3===(3&t)&&(n.push(r),r=0);return 3&t&&n.push(o.bitArray.partial(8*(3&t),r)),n}},o.codec.hex={fromBits:function(e){var t,n="";for(t=0;t<e.length;t++)n+=((0|e[t])+0xf00000000000).toString(16).substr(4);return n.substr(0,o.bitArray.bitLength(e)/4)},toBits:function(e){var t,n,r=[];for(e=e.replace(/\s|0x/g,""),n=e.length,e+="00000000",t=0;t<e.length;t+=8)r.push(0^parseInt(e.substr(t,8),16));return o.bitArray.clamp(r,4*n)}},o.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var r,i="",s=0,a=o.codec.base64._chars,c=0,u=o.bitArray.bitLength(e);for(n&&(a=a.substr(0,62)+"-_"),r=0;6*i.length<u;)i+=a.charAt((c^e[r]>>>s)>>>26),6>s?(c=e[r]<<6-s,s+=26,r++):(c<<=6,s-=6);for(;3&i.length&&!t;)i+="=";return i},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n,r,i=[],s=0,a=o.codec.base64._chars,c=0;for(t&&(a=a.substr(0,62)+"-_"),n=0;n<e.length;n++){if(r=a.indexOf(e.charAt(n)),0>r)throw new o.exception.invalid("this isn't base64!");s>26?(s-=26,i.push(c^r>>>s),c=r<<32-s):(s+=6,c^=r<<32-s)}return 56&s&&i.push(o.bitArray.partial(56&s,c,1)),i}},o.codec.base64url={fromBits:function(e){return o.codec.base64.fromBits(e,1,1)},toBits:function(e){return o.codec.base64.toBits(e,1)}},o.hash.sha256=function(e){this._key[0]||this._precompute(),e?(this._h=e._h.slice(0),this._buffer=e._buffer.slice(0),this._length=e._length):this.reset()},o.hash.sha256.hash=function(e){return(new o.hash.sha256).update(e).finalize()},o.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(e){"string"==typeof e&&(e=o.codec.utf8String.toBits(e));var t,n=this._buffer=o.bitArray.concat(this._buffer,e),r=this._length,i=this._length=r+o.bitArray.bitLength(e);for(t=512+r&-512;i>=t;t+=512)this._block(n.splice(0,16));return this},finalize:function(){var e,t=this._buffer,n=this._h;for(t=o.bitArray.concat(t,[o.bitArray.partial(1,1)]),e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(this._length/4294967296)),t.push(0|this._length);t.length;)this._block(t.splice(0,16));return this.reset(),n},_init:[],_key:[],_precompute:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,n=0,o=2;e:for(;64>n;o++){for(t=2;o>=t*t;t++)if(o%t===0)continue e;8>n&&(this._init[n]=e(Math.pow(o,.5))),this._key[n]=e(Math.pow(o,1/3)),n++}},_block:function(e){var t,n,o,r,i=e.slice(0),s=this._h,a=this._key,c=s[0],u=s[1],l=s[2],d=s[3],f=s[4],p=s[5],g=s[6],h=s[7];for(t=0;64>t;t++)16>t?n=i[t]:(o=i[t+1&15],r=i[t+14&15],n=i[15&t]=(o>>>7^o>>>18^o>>>3^o<<25^o<<14)+(r>>>17^r>>>19^r>>>10^r<<15^r<<13)+i[15&t]+i[t+9&15]|0),n=n+h+(f>>>6^f>>>11^f>>>25^f<<26^f<<21^f<<7)+(g^f&(p^g))+a[t],h=g,g=p,p=f,f=d+n|0,d=l,l=u,u=c,c=n+(u&l^d&(u^l))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+u|0,s[2]=s[2]+l|0,s[3]=s[3]+d|0,s[4]=s[4]+f|0,s[5]=s[5]+p|0,s[6]=s[6]+g|0,s[7]=s[7]+h|0}},o.mode.ccm={name:"ccm",encrypt:function(e,t,n,r,i){var s,a,c=t.slice(0),u=o.bitArray,l=u.bitLength(n)/8,d=u.bitLength(c)/8;if(i=i||64,r=r||[],7>l)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;4>s&&d>>>8*s;s++);return 15-l>s&&(s=15-l),n=u.clamp(n,8*(15-s)),a=o.mode.ccm._computeTag(e,t,n,r,i,s),c=o.mode.ccm._ctrMode(e,c,n,a,i,s),u.concat(c.data,c.tag)},decrypt:function(e,t,n,r,i){i=i||64,r=r||[];var s,a,c=o.bitArray,u=c.bitLength(n)/8,l=c.bitLength(t),d=c.clamp(t,l-i),f=c.bitSlice(t,l-i);if(l=(l-i)/8,7>u)throw new o.exception.invalid("ccm: iv must be at least 7 bytes");for(s=2;4>s&&l>>>8*s;s++);if(15-u>s&&(s=15-u),n=c.clamp(n,8*(15-s)),d=o.mode.ccm._ctrMode(e,d,n,f,i,s),a=o.mode.ccm._computeTag(e,d.data,n,r,i,s),!c.equal(d.tag,a))throw new o.exception.corrupt("ccm: tag doesn't match");return d.data},_computeTag:function(e,t,n,r,i,s){var a,c,u,l=[],d=o.bitArray,f=d._xor4;if(i/=8,i%2||4>i||i>16)throw new o.exception.invalid("ccm: invalid tag length");if(r.length>4294967295||t.length>4294967295)throw new o.exception.bug("ccm: can't deal with 4GiB or more data");if(a=[d.partial(8,(r.length?64:0)|i-2<<2|s-1)],a=d.concat(a,n),a[3]|=d.bitLength(t)/8,a=e.encrypt(a),r.length)for(c=d.bitLength(r)/8,65279>=c?l=[d.partial(16,c)]:4294967295>=c&&(l=d.concat([d.partial(16,65534)],[c])),l=d.concat(l,r),u=0;u<l.length;u+=4)a=e.encrypt(f(a,l.slice(u,u+4).concat([0,0,0])));for(u=0;u<t.length;u+=4)a=e.encrypt(f(a,t.slice(u,u+4).concat([0,0,0])));return d.clamp(a,8*i)},_ctrMode:function(e,t,n,r,i,s){var a,c,u,l=o.bitArray,d=l._xor4,f=t.length,p=l.bitLength(t);if(u=l.concat([l.partial(8,s-1)],n).concat([0,0,0]).slice(0,4),r=l.bitSlice(d(r,e.encrypt(u)),0,i),!f)return{tag:r,data:[]};for(c=0;f>c;c+=4)u[3]++,a=e.encrypt(u),t[c]^=a[0],t[c+1]^=a[1],t[c+2]^=a[2],t[c+3]^=a[3];return{tag:r,data:l.clamp(t,p)}}},o.mode.ocb2={name:"ocb2",encrypt:function(e,t,n,r,i,s){if(128!==o.bitArray.bitLength(n))throw new o.exception.invalid("ocb iv must be 128 bits");var a,c,u,l,d=o.mode.ocb2._times2,f=o.bitArray,p=f._xor4,g=[0,0,0,0],h=d(e.encrypt(n)),m=[];for(r=r||[],i=i||64,a=0;a+4<t.length;a+=4)c=t.slice(a,a+4),g=p(g,c),m=m.concat(p(h,e.encrypt(p(h,c)))),h=d(h);return c=t.slice(a),u=f.bitLength(c),l=e.encrypt(p(h,[0,0,0,u])),c=f.clamp(p(c.concat([0,0,0]),l),u),g=p(g,p(c.concat([0,0,0]),l)),g=e.encrypt(p(g,p(h,d(h)))),r.length&&(g=p(g,s?r:o.mode.ocb2.pmac(e,r))),m.concat(f.concat(c,f.clamp(g,i)))},decrypt:function(e,t,n,r,i,s){if(128!==o.bitArray.bitLength(n))throw new o.exception.invalid("ocb iv must be 128 bits");i=i||64;var a,c,u,l,d=o.mode.ocb2._times2,f=o.bitArray,p=f._xor4,g=[0,0,0,0],h=d(e.encrypt(n)),m=o.bitArray.bitLength(t)-i,v=[];for(r=r||[],a=0;m/32>a+4;a+=4)c=p(h,e.decrypt(p(h,t.slice(a,a+4)))),g=p(g,c),v=v.concat(c),h=d(h);if(u=m-32*a,l=e.encrypt(p(h,[0,0,0,u])),c=p(l,f.clamp(t.slice(a),u).concat([0,0,0])),g=p(g,c),g=e.encrypt(p(g,p(h,d(h)))),r.length&&(g=p(g,s?r:o.mode.ocb2.pmac(e,r))),!f.equal(f.clamp(g,i),f.bitSlice(t,m)))throw new o.exception.corrupt("ocb: tag doesn't match");return v.concat(f.clamp(c,u))},pmac:function(e,t){var n,r,i=o.mode.ocb2._times2,s=o.bitArray,a=s._xor4,c=[0,0,0,0],u=e.encrypt([0,0,0,0]);for(u=a(u,i(i(u))),n=0;n+4<t.length;n+=4)u=i(u),c=a(c,e.encrypt(a(u,t.slice(n,n+4))));return r=t.slice(n),s.bitLength(r)<128&&(u=a(u,i(u)),r=s.concat(r,[-2147483648,0,0,0])),c=a(c,r),e.encrypt(a(i(a(u,i(u))),c))},_times2:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}},o.mode.gcm={name:"gcm",encrypt:function(e,t,n,r,i){var s,a=t.slice(0),c=o.bitArray;return i=i||128,r=r||[],s=o.mode.gcm._ctrMode(!0,e,a,r,n,i),c.concat(s.data,s.tag)},decrypt:function(e,t,n,r,i){var s,a,c=t.slice(0),u=o.bitArray,l=u.bitLength(c);if(i=i||128,r=r||[],l>=i?(a=u.bitSlice(c,l-i),c=u.bitSlice(c,0,l-i)):(a=c,c=[]),s=o.mode.gcm._ctrMode(!1,e,c,r,n,i),!u.equal(s.tag,a))throw new o.exception.corrupt("gcm: tag doesn't match");return s.data},_galoisMultiply:function(e,t){var n,r,i,s,a,c,u=o.bitArray,l=u._xor4;for(s=[0,0,0,0],a=t.slice(0),n=0;128>n;n++){for(i=0!==(e[Math.floor(n/32)]&1<<31-n%32),i&&(s=l(s,a)),c=0!==(1&a[3]),r=3;r>0;r--)a[r]=a[r]>>>1|(1&a[r-1])<<31;a[0]=a[0]>>>1,c&&(a[0]=a[0]^225<<24)}return s},_ghash:function(e,t,n){var r,i,s=n.length;for(r=t.slice(0),i=0;s>i;i+=4)r[0]^=4294967295&n[i],r[1]^=4294967295&n[i+1],r[2]^=4294967295&n[i+2],r[3]^=4294967295&n[i+3],r=o.mode.gcm._galoisMultiply(r,e);return r},_ctrMode:function(e,t,n,r,i,s){var a,c,u,l,d,f,p,g,h,m,v,b,y=o.bitArray;for(h=n.length,m=y.bitLength(n),v=y.bitLength(r),b=y.bitLength(i),a=t.encrypt([0,0,0,0]),96===b?(c=i.slice(0),c=y.concat(c,[1])):(c=o.mode.gcm._ghash(a,[0,0,0,0],i),c=o.mode.gcm._ghash(a,c,[0,0,Math.floor(b/4294967296),4294967295&b])),u=o.mode.gcm._ghash(a,[0,0,0,0],r),f=c.slice(0),p=u.slice(0),e||(p=o.mode.gcm._ghash(a,u,n)),d=0;h>d;d+=4)f[3]++,l=t.encrypt(f),n[d]^=l[0],n[d+1]^=l[1],n[d+2]^=l[2],n[d+3]^=l[3];return n=y.clamp(n,m),e&&(p=o.mode.gcm._ghash(a,u,n)),g=[Math.floor(v/4294967296),4294967295&v,Math.floor(m/4294967296),4294967295&m],p=o.mode.gcm._ghash(a,p,g),l=t.encrypt(c),p[0]^=l[0],p[1]^=l[1],p[2]^=l[2],p[3]^=l[3],{tag:y.bitSlice(p,0,s),data:n}}},o.misc.hmac=function(e,t){this._hash=t=t||o.hash.sha256;var n,r=[[],[]],i=t.prototype.blockSize/32;for(this._baseHash=[new t,new t],e.length>i&&(e=t.hash(e)),n=0;i>n;n++)r[0][n]=909522486^e[n],r[1][n]=1549556828^e[n];this._baseHash[0].update(r[0]),this._baseHash[1].update(r[1]),this._resultHash=new t(this._baseHash[0])},o.misc.hmac.prototype.encrypt=o.misc.hmac.prototype.mac=function(e){if(this._updated)throw new o.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)},o.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},o.misc.hmac.prototype.update=function(e){this._updated=!0,this._resultHash.update(e)},o.misc.hmac.prototype.digest=function(){var e=this._resultHash.finalize(),t=new this._hash(this._baseHash[1]).update(e).finalize();return this.reset(),t},o.misc.pbkdf2=function(e,t,n,r,i){if(n=n||1e3,0>r||0>n)throw o.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=o.codec.utf8String.toBits(e)),"string"==typeof t&&(t=o.codec.utf8String.toBits(t)),i=i||o.misc.hmac;var s,a,c,u,l,d=new i(e),f=[],p=o.bitArray;for(l=1;32*f.length<(r||1);l++){for(s=a=d.encrypt(p.concat(t,[l])),c=1;n>c;c++)for(a=d.encrypt(a),u=0;u<a.length;u++)s[u]^=a[u];f=f.concat(s)}return r&&(f=p.clamp(f,r)),f},o.prng=function(e){this._pools=[new o.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=e,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},o.prng.prototype={randomWords:function(e,t){var n,r,i=[],s=this.isReady(t);if(s===this._NOT_READY)throw new o.exception.notReady("generator isn't seeded");for(s&this._REQUIRES_RESEED&&this._reseedFromPools(!(s&this._READY)),n=0;e>n;n+=4)(n+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),r=this._gen4words(),i.push(r[0],r[1],r[2],r[3]);return this._gate(),i.slice(0,e)},setDefaultParanoia:function(e,t){if(0===e&&"Setting paranoia=0 will ruin your security; use it only for testing"!==t)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=e},addEntropy:function(e,t,n){n=n||"user";var r,i,s,a,c=(new Date).valueOf(),u=this._robins[n],l=this.isReady(),d=0;switch(r=this._collectorIds[n],void 0===r&&(r=this._collectorIds[n]=this._collectorIdNext++),void 0===u&&(u=this._robins[n]=0),this._robins[n]=(this._robins[n]+1)%this._pools.length,typeof e){case"number":void 0===t&&(t=1),this._pools[u].update([r,this._eventId++,1,t,c,1,0|e]);break;case"object":if(a=Object.prototype.toString.call(e),"[object Uint32Array]"===a){for(s=[],i=0;i<e.length;i++)s.push(e[i]);e=s}else for("[object Array]"!==a&&(d=1),i=0;i<e.length&&!d;i++)"number"!=typeof e[i]&&(d=1);if(!d){if(void 0===t)for(t=0,i=0;i<e.length;i++)for(s=e[i];s>0;)t++,s>>>=1;this._pools[u].update([r,this._eventId++,2,t,c,e.length].concat(e))}break;case"string":void 0===t&&(t=e.length),this._pools[u].update([r,this._eventId++,3,t,c,e.length]),this._pools[u].update(e);break;default:d=1}if(d)throw new o.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[u]+=t,this._poolStrength+=t,l===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(e){var t=this._PARANOIA_LEVELS[void 0!==e?e:this._defaultParanoia];return this._strength&&this._strength>=t?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=t?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(e){var t=this._PARANOIA_LEVELS[e?e:this._defaultParanoia];return this._strength>=t?1:this._poolStrength>t?1:this._poolStrength/t},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else{if(!document.attachEvent)throw new o.exception.bug("can't attach event");

document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(e,t){this._callbacks[e][this._callbackI++]=t},removeEventListener:function(e,t){var n,o,r=this._callbacks[e],i=[];for(o in r)r.hasOwnProperty(o)&&r[o]===t&&i.push(o);for(n=0;n<i.length;n++)o=i[n],delete r[o]},_bind:function(e){var t=this;return function(){e.apply(t,arguments)}},_gen4words:function(){for(var e=0;4>e&&(this._counter[e]=this._counter[e]+1|0,!this._counter[e]);e++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new o.cipher.aes(this._key)},_reseed:function(e){this._key=o.hash.sha256.hash(this._key.concat(e)),this._cipher=new o.cipher.aes(this._key);for(var t=0;4>t&&(this._counter[t]=this._counter[t]+1|0,!this._counter[t]);t++);},_reseedFromPools:function(e){var t,n=[],r=0;for(this._nextReseed=n[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,t=0;16>t;t++)n.push(4294967296*Math.random()|0);for(t=0;t<this._pools.length&&(n=n.concat(this._pools[t].finalize()),r+=this._poolEntropy[t],this._poolEntropy[t]=0,e||!(this._reseedCount&1<<t));t++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new o.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=r,r>this._strength&&(this._strength=r),this._reseedCount++,this._reseed(n)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(e){var t,n;try{t=e.x||e.clientX||e.offsetX||0,n=e.y||e.clientY||e.offsetY||0}catch(r){t=0,n=0}0!=t&&0!=n&&o.random.addEntropy([t,n],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(e){var t=e.touches[0]||e.changedTouches[0],n=t.pageX||t.clientX,r=t.pageY||t.clientY;o.random.addEntropy([n,r],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(e){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?o.random.addEntropy(window.performance.now(),e,"loadtime"):o.random.addEntropy((new Date).valueOf(),e,"loadtime")},_accelerometerCollector:function(e){var t=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z;if(window.orientation){var n=window.orientation;"number"==typeof n&&o.random.addEntropy(n,1,"accelerometer")}t&&o.random.addEntropy(t,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(e,t){var n,r=o.random._callbacks[e],i=[];for(n in r)r.hasOwnProperty(n)&&i.push(r[n]);for(n=0;n<i.length;n++)i[n](t)}},o.random=new o.prng(6),function(){function e(){return null}try{var n,r,i;if("undefined"!=typeof t&&t.exports&&(r=e())&&r.randomBytes)n=r.randomBytes(128),n=new Uint32Array(new Uint8Array(n).buffer),o.random.addEntropy(n,1024,"crypto.randomBytes");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(i=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(i);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)return;window.msCrypto.getRandomValues(i)}o.random.addEntropy(i,1024,"crypto.getRandomValues")}}catch(s){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(s))}}(),o.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(e,t,n,r){n=n||{},r=r||{};var i,s,a,c=o.json,u=c._add({iv:o.random.randomWords(4,0)},c.defaults);if(c._add(u,n),a=u.adata,"string"==typeof u.salt&&(u.salt=o.codec.base64.toBits(u.salt)),"string"==typeof u.iv&&(u.iv=o.codec.base64.toBits(u.iv)),!o.mode[u.mode]||!o.cipher[u.cipher]||"string"==typeof e&&u.iter<=100||64!==u.ts&&96!==u.ts&&128!==u.ts||128!==u.ks&&192!==u.ks&&256!==u.ks||u.iv.length<2||u.iv.length>4)throw new o.exception.invalid("json encrypt: invalid parameters");return"string"==typeof e?(i=o.misc.cachedPbkdf2(e,u),e=i.key.slice(0,u.ks/32),u.salt=i.salt):o.ecc&&e instanceof o.ecc.elGamal.publicKey&&(i=e.kem(),u.kemtag=i.tag,e=i.key.slice(0,u.ks/32)),"string"==typeof t&&(t=o.codec.utf8String.toBits(t)),"string"==typeof a&&(u.adata=a=o.codec.utf8String.toBits(a)),s=new o.cipher[u.cipher](e),c._add(r,u),r.key=e,u.ct=o.mode[u.mode].encrypt(s,t,u.iv,a,u.ts),u},encrypt:function(e,t,n,r){var i=o.json,s=i._encrypt.apply(i,arguments);return i.encode(s)},_decrypt:function(e,t,n,r){n=n||{},r=r||{};var i,s,a,c=o.json,u=c._add(c._add(c._add({},c.defaults),t),n,!0),l=u.adata;if("string"==typeof u.salt&&(u.salt=o.codec.base64.toBits(u.salt)),"string"==typeof u.iv&&(u.iv=o.codec.base64.toBits(u.iv)),!o.mode[u.mode]||!o.cipher[u.cipher]||"string"==typeof e&&u.iter<=100||64!==u.ts&&96!==u.ts&&128!==u.ts||128!==u.ks&&192!==u.ks&&256!==u.ks||!u.iv||u.iv.length<2||u.iv.length>4)throw new o.exception.invalid("json decrypt: invalid parameters");return"string"==typeof e?(s=o.misc.cachedPbkdf2(e,u),e=s.key.slice(0,u.ks/32),u.salt=s.salt):o.ecc&&e instanceof o.ecc.elGamal.secretKey&&(e=e.unkem(o.codec.base64.toBits(u.kemtag)).slice(0,u.ks/32)),"string"==typeof l&&(l=o.codec.utf8String.toBits(l)),a=new o.cipher[u.cipher](e),i=o.mode[u.mode].decrypt(a,u.ct,u.iv,l,u.ts),c._add(r,u),r.key=e,1===n.raw?i:o.codec.utf8String.fromBits(i)},decrypt:function(e,t,n,r){var i=o.json;return i._decrypt(e,i.decode(t),n,r)},encode:function(e){var t,n="{",r="";for(t in e)if(e.hasOwnProperty(t)){if(!t.match(/^[a-z0-9]+$/i))throw new o.exception.invalid("json encode: invalid property name");switch(n+=r+'"'+t+'":',r=",",typeof e[t]){case"number":case"boolean":n+=e[t];break;case"string":n+='"'+escape(e[t])+'"';break;case"object":n+='"'+o.codec.base64.fromBits(e[t],0)+'"';break;default:throw new o.exception.bug("json encode: unsupported type")}}return n+"}"},decode:function(e){if(e=e.replace(/\s/g,""),!e.match(/^\{.*\}$/))throw new o.exception.invalid("json decode: this isn't json!");var t,n,r=e.replace(/^\{|\}$/g,"").split(/,/),i={};for(t=0;t<r.length;t++){if(!(n=r[t].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new o.exception.invalid("json decode: this isn't json!");n[3]?i[n[2]]=parseInt(n[3],10):n[4]?i[n[2]]=n[2].match(/^(ct|adata|salt|iv)$/)?o.codec.base64.toBits(n[4]):unescape(n[4]):n[5]&&(i[n[2]]="true"===n[5])}return i},_add:function(e,t,n){if(void 0===e&&(e={}),void 0===t)return e;var r;for(r in t)if(t.hasOwnProperty(r)){if(n&&void 0!==e[r]&&e[r]!==t[r])throw new o.exception.invalid("required parameter overridden");e[r]=t[r]}return e},_subtract:function(e,t){var n,o={};for(n in e)e.hasOwnProperty(n)&&e[n]!==t[n]&&(o[n]=e[n]);return o},_filter:function(e,t){var n,o={};for(n=0;n<t.length;n++)void 0!==e[t[n]]&&(o[t[n]]=e[t[n]]);return o}},o.encrypt=o.json.encrypt,o.decrypt=o.json.decrypt,o.misc._pbkdf2Cache={},o.misc.cachedPbkdf2=function(e,t){var n,r,i,s,a=o.misc._pbkdf2Cache;return t=t||{},s=t.iter||1e3,r=a[e]=a[e]||{},n=r[s]=r[s]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):o.random.randomWords(2,0)},i=void 0===t.salt?n.firstSalt:t.salt,n[i]=n[i]||o.misc.pbkdf2(e,i,t.iter),{key:n[i].slice(0),salt:i.slice(0)}}},{}],3:[function(e,t,n){!function(e,n){"use strict";var o="0.7.8",r="",i="?",s="function",a="undefined",c="object",u="string",l="major",d="model",f="name",p="type",g="vendor",h="version",m="architecture",v="console",b="mobile",y="tablet",I="smarttv",E="wearable",w="embedded",_={extend:function(e,t){for(var n in t)-1!=="browser cpu device engine os".indexOf(n)&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){return"string"==typeof e?-1!==t.toLowerCase().indexOf(e.toLowerCase()):!1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===u?e.split(".")[0]:n}},S={rgx:function(){for(var e,t,o,r,i,u,l,d=0,f=arguments;d<f.length&&!u;){var p=f[d],g=f[d+1];if(typeof e===a){e={};for(r in g)i=g[r],typeof i===c?e[i[0]]=n:e[i]=n}for(t=o=0;t<p.length&&!u;)if(u=p[t++].exec(this.getUA()))for(r=0;r<g.length;r++)l=u[++o],i=g[r],typeof i===c&&i.length>0?2==i.length?e[i[0]]=typeof i[1]==s?i[1].call(this,l):i[1]:3==i.length?e[i[0]]=typeof i[1]!==s||i[1].exec&&i[1].test?l?l.replace(i[1],i[2]):n:l?i[1].call(this,l,i[2]):n:4==i.length&&(e[i[0]]=l?i[3].call(this,l.replace(i[1],i[2])):n):e[i]=l?l:n;d+=2}return e},str:function(e,t){for(var o in t)if(typeof t[o]===c&&t[o].length>0){for(var r=0;r<t[o].length;r++)if(_.has(t[o][r],e))return o===i?n:o}else if(_.has(t[o],e))return o===i?n:o;return e}},N={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},T={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[f,h],[/\s(opr)\/([\w\.]+)/i],[[f,"Opera"],h],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[f,h],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[f,"IE"],h],[/(edge)\/((\d+)?[\w\.]+)/i],[f,h],[/(yabrowser)\/([\w\.]+)/i],[[f,"Yandex"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],h],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[f,h],[/(dolfin)\/([\w\.]+)/i],[[f,"Dolphin"],h],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[f,"Chrome"],h],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[h,[f,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[h,[f,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[h,[f,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[h,[f,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[h,f],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[f,[h,S.str,N.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[f,h],[/(navigator|netscape)\/([\w\.-]+)/i],[[f,"Netscape"],h],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[f,h]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,_.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",_.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,_.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[d,g,[p,y]],[/applecoremedia\/[\w\.]+ \((ipad)/],[d,[g,"Apple"],[p,y]],[/(apple\s{0,1}tv)/i],[[d,"Apple TV"],[g,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[g,d,[p,y]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[d,[g,"Amazon"],[p,y]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[d,S.str,N.device.amazon.model],[g,"Amazon"],[p,b]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[d,g,[p,b]],[/\((ip[honed|\s\w*]+);/i],[d,[g,"Apple"],[p,b]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[g,d,[p,b]],[/\(bb10;\s(\w+)/i],[d,[g,"BlackBerry"],[p,b]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[d,[g,"Asus"],[p,y]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[g,"Sony"],[d,"Xperia Tablet"],[p,y]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[g,"Sony"],[d,"Xperia Phone"],[p,b]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[g,d,[p,v]],[/android.+;\s(shield)\sbuild/i],[d,[g,"Nvidia"],[p,v]],[/(playstation\s[3portablevi]+)/i],[d,[g,"Sony"],[p,v]],[/(sprint\s(\w+))/i],[[g,S.str,N.device.sprint.vendor],[d,S.str,N.device.sprint.model],[p,b]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[g,d,[p,y]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[g,[d,/_/g," "],[p,b]],[/(nexus\s9)/i],[d,[g,"HTC"],[p,y]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[d,[g,"Microsoft"],[p,v]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[g,"Microsoft"],[p,b]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i],[d,[g,"Motorola"],[p,b]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[d,[g,"Motorola"],[p,y]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[g,"Samsung"],d,[p,y]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[g,"Samsung"],d,[p,b]],[/(samsung);smarttv/i],[g,d,[p,I]],[/\(dtv[\);].+(aquos)/i],[d,[g,"Sharp"],[p,I]],[/sie-(\w+)*/i],[d,[g,"Siemens"],[p,b]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[g,"Nokia"],d,[p,b]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[d,[g,"Acer"],[p,y]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[g,"LG"],d,[p,y]],[/(lg) netcast\.tv/i],[g,d,[p,I]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[d,[g,"LG"],[p,b]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[d,[g,"Lenovo"],[p,y]],[/linux;.+((jolla));/i],[g,d,[p,b]],[/((pebble))app\/[\d\.]+\s/i],[g,d,[p,E]],[/android.+;\s(glass)\s\d/i],[d,[g,"Google"],[p,E]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[d,/_/g," "],[g,"Xiaomi"],[p,b]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[p,_.lowerize],g,d]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[h,[f,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[f,h],[/rv\:([\w\.]+).*(gecko)/i],[h,f]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[f,h],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[f,[h,S.str,N.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[f,"Windows"],[h,S.str,N.os.windows.version]],[/\((bb)(10);/i],[[f,"BlackBerry"],h],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[f,h],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[f,"Symbian"],h],[/\((series40);/i],[f],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[f,"Firefox OS"],h],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[f,h],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[f,"Chromium OS"],h],[/(sunos)\s?([\w\.]+\d)*/i],[[f,"Solaris"],h],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[f,h],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[f,"iOS"],[h,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[f,"Mac OS"],[h,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[f,h]]},O=function(t,n){if(!(this instanceof O))return new O(t,n).getResult();var o=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:r),i=n?_.extend(T,n):T;return this.getBrowser=function(){var e=S.rgx.apply(this,i.browser);return e.major=_.major(e.version),e},this.getCPU=function(){return S.rgx.apply(this,i.cpu)},this.getDevice=function(){return S.rgx.apply(this,i.device)},this.getEngine=function(){return S.rgx.apply(this,i.engine)},this.getOS=function(){return S.rgx.apply(this,i.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return o},this.setUA=function(e){return o=e,this},this.setUA(o),this};O.VERSION=o,O.BROWSER={NAME:f,MAJOR:l,VERSION:h},O.CPU={ARCHITECTURE:m},O.DEVICE={MODEL:d,VENDOR:g,TYPE:p,CONSOLE:v,MOBILE:b,SMARTTV:I,TABLET:y,WEARABLE:E,EMBEDDED:w},O.ENGINE={NAME:f,VERSION:h},O.OS={NAME:f,VERSION:h},t.exports=O}(this)},{}],4:[function(e,t,n){function o(){l&&a&&(l=!1,a.length?u=a.concat(u):d=-1,u.length&&r())}function r(){if(!l){var e=setTimeout(o);l=!0;for(var t=u.length;t;){for(a=u,u=[];++d<t;)a&&a[d].run();d=-1,t=u.length}a=null,l=!1,clearTimeout(e)}}function i(e,t){this.fun=e,this.array=t}function s(){}var a,c=t.exports={},u=[],l=!1,d=-1;c.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new i(e,t)),1!==u.length||l||setTimeout(r,0)},i.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=s,c.addListener=s,c.once=s,c.off=s,c.removeListener=s,c.removeAllListeners=s,c.emit=s,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],5:[function(e,t,n){!function(){"use strict";t.exports="1563310c3c3"}()},{}],6:[function(e,t,n){!function(){"use strict";function n(e){return i.getCookie(e)}function o(e,t,n,o,u,l){var d=!1;return c.test(n)&&(n=n.replace(c,""),d=!0),i.setCookie(e,t,n,o,u,l),d&&r(e,"www"+(/^\./.test(n)?n:"."+n),o||""),n||s.publish("log.send",{action_name:"log:cookie:write:nodomain",success:"false",process_time:0,info:{topHost:a},timestamp:new Date,error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",appid:"DTSS-DISNEYID-UI"}),!0}function r(e,t,n){return i.deleteCookie(e,t,n),t&&!c.test(t)&&i.deleteCookie(e,"www"+(/^\./.test(t)?"":".")+t,n),!0}var i=e("utils"),s=e("messages").getInstance(),a=i.getQueryStringParams(document.location.href).topHost||document.location.host,c=/^\.?www/;t.exports={read:n,write:o,remove:r}}()},{messages:13,utils:30}],7:[function(e,t,n){!function(){"use strict";function n(){r.subscribe("debug.geoIP",function(e){i.ip=e}),r.subscribe("debug.country",function(e){i.country=e}),r.subscribe("debug.clear",function(){i={}})}var o=e("utils"),r=e("messages").getInstance(),i={};t.exports={getGeoIP:function(){return o.get(i,"ip")},getCountry:function(){return o.get(i,"country")}},n()}()},{messages:13,utils:30}],8:[function(e,t,n){!function(){"use strict";function n(e){return u[a(e)]||"QA"}function o(e){return l[e].clientIdEnv}function r(e){return!!e.match(/-(DEV|VALID|QA|STAGE|PROD)$/)}function i(e){var t=null;return(e||"").replace(/-(DEV|VALID|QA|STAGE|PROD)$/,function(e,n){t=n}),t}function s(e){return c.clone(l[e])}function a(e){var t=document.createElement("a");return t.setAttribute("href",e),""+t.hostname}t.exports={getEnvironmentFromUrl:n,getClientIdEnvironment:o,getConfig:s,getClientIdSuffix:i,clientIdHasSuffix:r};var c=e("utils"),u={"127.0.0.1":"QA",localhost:"QA","did.registerdisney.go.com":"LOCAL","local.registerdisney.go.com":"LOCAL","ui-local.registerdisney.go.com":"LOCAL","dev.registerdisney.go.com":"DEV","qa.registerdisney.go.com":"QA","ui-qa.registerdisney.go.com":"QA","ui-stg.dark.registerdisney.go.com":"STAGE-DARK","stg.dark.registerdisney.go.com":"STAGE-DARK","stg.registerdisney.go.com":"STAGE","stg.cdn.registerdisney.go.com":"STAGE","val.registerdisney.go.com":"VALID","ui-val.registerdisney.go.com":"VALID","dark.registerdisney.go.com":"PROD-DARK","registerdisney.go.com":"PROD","cdn.registerdisney.go.com":"PROD"},l={LOCAL:{clientIdEnv:"QA",contentEnvironment:"qa",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/qa/utag.js",guestControllerPath:"https://local.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},DEV:{clientIdEnv:"DEV",contentEnvironment:"dev",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://qa.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},VALID:{clientIdEnv:"VALID",contentEnvironment:"val",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://val.registerdisney.go.com/jgc/v2",l10nPath:"https://val-l10n.registerdisney.go.com/v2/collection"},QA:{clientIdEnv:"QA",contentEnvironment:"qa",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/qa/utag.js",guestControllerPath:"https://qa.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},"STAGE-DARK":{clientIdEnv:"STAGE",contentEnvironment:"stg",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://stg.dark.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},STAGE:{clientIdEnv:"STAGE",contentEnvironment:"stg",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://stg.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},"PROD-DARK":{clientIdEnv:"PROD",contentEnvironment:"prod",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://dark.registerdisney.go.com/jgc/v2",l10nPath:"https://l10n.registerdisney.go.com/v2/collection"},PROD:{clientIdEnv:"PROD",contentEnvironment:"prod",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://registerdisney.go.com/jgc/v2",l10nPath:"https://l10n.registerdisney.go.com/v2/collection"}}}()},{utils:30}],9:[function(e,t,n){!function(){"use strict";function e(e,t,n){"undefined"==typeof e[t]&&(e[t]=[]),e[t].push(n)}function n(e,t,n){if("undefined"!=typeof e[t]){var o=e[t].length;if("undefined"==typeof n)e[t]=[];else for(;o;)e[t][o-1]==n&&e[t].splice(o-1,1),o--}}function o(e,t){if(e=[].concat(e[t]||[]).concat(e["*"]||[]),e.length>0){var n=arguments.length>2?Array.prototype.slice.call(arguments,2):[];e.forEach(function(e){try{e.apply({eventName:t},n)}catch(t){setTimeout(function(){throw t},0)}})}}function r(t){var r=t.prototype||t,i={};return r.on=function(t,n){e.call(this,i,t,n)},r.off=function(e,t){n.call(this,i,e,t)},r.emit=function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(i),o.apply(this,e)},r.clear=function(){i={}},t}t.exports={emittable:r}}()},{}],10:[function(e,t,n){!function(){"use strict";t.exports=e("./event-emitter")}()},{"./event-emitter":9}],11:[function(e,t,n){!function(){"use strict";function n(e){var t=s.get(e,"error.errors"),n=s.get(e,"error.keyCategory"),o=!t||!n||!s.get(t,"length");return o?[]:t.filter(function(e){return e.category===n})}function o(e,t){return r(e,t)[0]}function r(e,t){var n=[];if(!Array.isArray(e))return[];Array.isArray(t)||(t=[t]);for(var o=0;o<e.length;o++)-1!==t.indexOf(e[o].code)&&n.push(e[o]);return n}function i(e){return Array.isArray(e)?e.map(function(e){return e.code+(e.inputName?":"+e.inputName:"")}).join(","):null}var s=e("utils");t.exports={getKeyErrors:n,find:o,findAll:r,getErrorCodes:i}}()},{utils:30}],12:[function(e,t,n){!function(){"use strict";var n={ERROR:5,WARN:4,INFO:3,DEBUG:2,LOG:1,OFF:0},o={ERROR:"color:#FC0C1B;background-color:#FFEFEF",WARN:"color:#5B3A06;background-color:#FFFBE6",INFO:"color:#363F47;background-color:#e1e9ff",DEBUG:"color:#444;background-color:#eee",LOG:"color:#000;background-color:transparent",DEFAULT:"color:#000;background-color:transparent;font-weight:",ONEID:"color:#2887b4;background-color:transparent;font-weight:bold"},r=(e("utils"),n.INFO),i=function(){},s=function(){function e(e){"undefined"==typeof n[e.toUpperCase()]?this.error("Invalid log level specified: ",e):Object.keys(n).forEach(function(t){e.toUpperCase()===t&&(r=n[t],s())})}function t(){var e;return Object.keys(n).forEach(function(t){r===n[t]&&(e=t)}),e}function s(){var e=c?"%c[OneID]%c %c[%s]%c: ":"[OneID] [%s]: ";for(var t in n)a[t.toLowerCase()]=c?r<=n[t]&&r!==n.OFF?window.console[t.toLowerCase()].bind(window.console,e,o["ONEID"],o["DEFAULT"],o[t],t,o["DEFAULT"]):i:r<=n[t]&&r!==n.OFF?window.console[t.toLowerCase()].bind(window.console,e,t):i}var a=this,c=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("firefox")>-1||e.indexOf("chrome")>-1}();this.setLogLevel=e,this.getLogLevel=t,this.LEVELS=n,s()};t.exports=new s}()},{utils:30}],13:[function(e,t,n){!function(){"use strict";function n(){return u}function o(e){var t=Array.prototype.slice.call(arguments,1);"undefined"!=typeof a[e]&&s.clone(a[e]).forEach(function(e){e.callback.apply(null,t)})}function r(e,t){if(!(t instanceof Function))throw new Error("callback must be a function");return a[e]||(a[e]=[]),a[e].push({callback:t,identifier:c}),function(e,t){return function(){if(Array.isArray(a[e]))for(var n=0;n<a[e].length;n++)if(a[e][n].identifier===t)return void a[e].splice(n,1)}}(e,c++)}function i(e,t){return e?void("undefined"!=typeof a[e]&&a[e].forEach(function(n,o){n.callback!==t&&t||a[e].splice(o,1)})):a={}}var s=e("../utils"),a=(e("logger"),{}),c=0,u={publish:o,subscribe:r,unsubscribe:i};t.exports={getInstance:n}}()},{"../utils":30,logger:12}],14:[function(e,t,n){!function(){"use strict";function n(e,t){function a(e){function t(){function t(){f(),p=setTimeout(t,n.SATURATE_INTERVAL)}i.debug("aquiring mutex"),t(),g=!0,"function"==typeof e&&(i.debug("calling aquire success callback"),e())}i.log("Mutex#aquire"),setTimeout(function(){return c()?(i.debug("mutex is locked"),void d(function(){t(e)})):void t(e)},o(n.RANDOM_BASE,n.RANDOM_VARIANCE))}function c(){return null!==s.read(h)}function u(){return g===!0}function l(){i.log("Mutex#release"),u()&&(i.debug("releasing mutex"),clearTimeout(p),p=null,s.remove(h,t,m),g=!1)}function d(e){function t(){return i.debug("wait timeout called"),c()?void setTimeout(t,n.WAIT_INTERVAL+r):(i.debug("mutex has been released"),e())}if("function"==typeof e){i.debug("wait called");var r=o(n.RANDOM_BASE,n.RANDOM_VARIANCE);i.debug("random variance is "+r),i.debug("wait timeout is "+n.WAIT_INTERVAL+r),t()}}function f(){i.debug("saturating mutex");var e=new Date((new Date).getTime()+n.EXPIRE_INTERVAL);s.write(h,"0",t,m,e)}this.aquire=a,this.release=l,this.wait=d,this.isLocked=c,this.isLockedByUs=u;var p,g,h="mtx"+r.crc32(e).toString(16),m="/";t=t||window.location.host}function o(e,t){return Math.floor(Math.random()*t+e)}t.exports=n;var r=e("utils"),i=e("logger"),s=e("cookie");n.SATURATE_INTERVAL=5e3,n.EXPIRE_INTERVAL=2e4,n.WAIT_INTERVAL=5e3,n.RANDOM_BASE=1e3,n.RANDOM_VARIANCE=1e3}()},{cookie:6,logger:12,utils:30}],15:[function(e,t,n){!function(){"use strict";var e=function(){};window.console=window.console||{},window.console.log=window.console.log||e,window.console.error=window.console.error||e,window.console.warn=window.console.warn||e,window.console.debug=window.console.debug||e}()},{}],16:[function(e,t,n){!function(){t.exports={CLIENT:"lightbox-client-window",LIGHTBOX:"lightbox-main-iframe",RESPONDER:"lightbox-responder",MIGRATION_RESPONDER:"lightbox-migration-responder",MOCK:"lightbox-mock-api"}}()},{}],17:[function(e,t,n){!function(){"use strict";t.exports=e("./postmessage-transport")}()},{"./postmessage-transport":18}],18:[function(e,t,n){!function(){"use strict";function n(e){this.name=e,this.emitter=I.emittable(Object.create(null)),this.initialized=!1,this.deferreds={},this.targets={},this.pendingTargets={},this.parents=[]}function o(){if(this.initialized)throw"Cannot attach new listeners once init() has been invoked";this.emitter.on.apply(this,arguments)}function r(){this.emitter.emit.apply(this,arguments)}function i(){b.log("PostMessageTransport#init"),this.initialized||(window.addEventListener("message",l.bind(this),!1),s.call(this),delete this.parents,this.initialized=!0)}function s(){b.log("PostMessageTransport#resolveParents");var e=this;e.parents.forEach(function(t){var n=Date.now(),o=e.targets[t];!function r(){clearTimeout(o.timeout),o.window.postMessage(JSON.stringify({type:"handshake",name:e.name}),o.origin),o.isReady===!1&&(Date.now()-n>w?(m(),e.emit("error","Parent window has not responded within 60 seconds")):o.timeout=setTimeout(r,50))}()})}function a(e,t){b.log("PostMessageTransport#registerChild: "+e);var n=v.defer();if(this.initialized)throw"Cannot attach child windows after init has been invoked";"undefined"==typeof this.targets[e]&&(this.targets[e]={origin:t,ready:n.promise},this.pendingTargets[e]=n)}function c(e,t){b.log("PostMessageTransport#registerParent: "+e);var n=v.defer();if(this.initialized)throw"Cannot attach parent windows after init has been invoked";if("undefined"==typeof this.targets[e]){var o={window:window.parent,origin:t,isReady:!1,ready:n.promise,timeout:null};this.targets[e]=o,this.pendingTargets[e]=n,this.parents.push(e)}}function u(e,t,n,o){if("undefined"==typeof this.targets[e])throw"Cannot postMessage to undefined window ["+e+"]";var r={type:"message",name:this.name,eventName:t,data:n};if("undefined"!=typeof o){var i=y.uuid();this.deferreds[i]=o,r.deferredUuid=i}var s=this.targets[e];s.ready.then(function(){s.window.postMessage(JSON.stringify(r),s.origin)})}function l(e){var t;try{t=JSON.parse(e.data)}catch(n){return}_.hasOwnProperty(t.type)&&_[t.type].call(this,e,t)}function d(e,t){b.log("PostMessageTransport#handleHandshakeAck");var n=this,o=n.targets[t.name];"undefined"!=typeof o&&(clearTimeout(o.timeout),o.window=e.source,o.isReady=!0,n.pendingTargets[t.name].resolve())}function f(e,t){b.log("PostMessageTransport#handleHandshake");var n=this,o=n.targets[t.name];"undefined"!=typeof o&&(o.window=e.source,n.pendingTargets[t.name].resolve(),o.window.postMessage(JSON.stringify({type:"handshakeAck",name:n.name}),o.origin))}function p(e,t){"undefined"!=typeof this.deferreds[t.deferredUuid]&&(this.deferreds[t.deferredUuid][t.action].call(null,t.data),delete this.deferreds[t.deferredUuid])}function g(e,t){var n=this;if("undefined"!=typeof t.name&&"undefined"!=typeof n.targets[t.name]){var o=n.targets[t.name];if("string"==typeof t.deferredUuid){var r=v.defer();r.promise.then(function(e){h(o.window,o.origin,t.deferredUuid,"resolve",e)},function(e){h(o.window,o.origin,t.deferredUuid,"reject",e)}),n.emit(t.eventName,t.data,r)}else n.emit(t.eventName,t.data)}}function h(e,t,n,o,r){var i={data:r,type:"deferred",deferredUuid:n,action:o};e.postMessage(JSON.stringify(i),t)}function m(){e("messages").getInstance();E.error("log:pmt-timeout",{conversation_id:y.uuid(),anon:!0,swid:"",
error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR"})}var v=e("../../../../assets/common/js/q"),b=e("logger"),y=e("../utils"),I=e("../event-emitter"),E=e("metrics"),w=6e4;t.exports=n;var _={handshake:f,handshakeAck:d,deferred:p,message:g};n.prototype.init=i,n.prototype.registerChild=a,n.prototype.registerParent=c,n.prototype.send=u,n.prototype.on=o,n.prototype.emit=r}()},{"../../../../assets/common/js/q":1,"../event-emitter":10,"../utils":30,logger:12,messages:13,metrics:38}],19:[function(e,t,n){t.exports={fields:["email","firstName","gender","lastName","middleName","prefix","suffix","username","languagePreference","pronunciationName","address.billing","address.home","address.other","address.school","address.shipping","address.work","phone.day","phone.fax","phone.mobile","phone.night","displayName","proposedDisplayName","dateOfBirth","password"],disallowedFields:["email","username","address.other","phone.fax","dateOfBirth","password","displayName"],allowedAddressValues:["line1","line2","line3","city","stateProvince","postalCode","country","preferred"],allowedPhoneValues:["number","internationalPrefix","extension","preferred"]}},{}],20:[function(e,t,n){!function(){"use strict";function n(e,t){var n,s=o.fields.filter(function(e){return o.disallowedFields.indexOf(e)<0}),a={data:{},required:{}},c="compliance.ageBands."+e.profile.ageBand+".UPDATE",u=i.get(t,c),l=r.dictionaryFromKey(e.profile.addresses,"type"),d=r.dictionaryFromKey(e.profile.phones,"type"),f=r.createDataTemplate(i.get(t,c+".addresses")),p=r.createDataTemplate(i.get(t,c+".phones")),g=i.get(t,"displayName"),h=i.get(g,"enabled");return s.forEach(function(t){n=(t.split(".")[1]||"").toUpperCase(),t.indexOf("address")>-1&&u.addresses?a=r.flatten({existingProfile:l,template:f,config:u.addresses.type,allowedValues:o.allowedAddressValues,fieldValue:t,editableProfile:a,type:n}):t.indexOf("phone")>-1&&u.phones?a=r.flatten({existingProfile:d,template:p,config:u.phones.type,allowedValues:o.allowedPhoneValues,fieldValue:t,editableProfile:a,type:n}):t.toLowerCase().indexOf("displayname")>-1&&h?a.data[t]=i.get(e,"displayName."+t):u[t]&&(a.data[t]=i.get(e,"profile."+t),a.required[t]=i.get(u,t).required||!1)}),a}var o=e("./fields.json"),r=e("./ppc-utils.js"),i=e("utils");t.exports={getEditableAndRequiredFields:n}}()},{"./fields.json":19,"./ppc-utils.js":21,utils:30}],21:[function(e,t,n){!function(){"use strict";function e(e,t){return e=e||[],e.reduce(function(e,n){return"undefined"==typeof e[n[t]]&&(e[n[t]]=n),e},{})}function n(e){if(e=e||{},e&&"EDITABLE"===e.editable){var t=e.type||{};return Object.keys(t).reduce(function(e,n){var o=t[n]||{};return e[n]=Object.keys(o).reduce(function(e,t){return"EDITABLE"===o[t].editable&&"type"!==t&&(e[t]=null),e},{}),e},{})}return null}function o(e){var t=e.existingProfile[e.type]||e.template[e.type]||e.template.DEFAULT||null,n=e.config[e.type]||e.config.DEFAULT||null;return t&&n&&Object.keys(t).forEach(function(o){if(e.allowedValues.indexOf(o)>-1){var r=e.fieldValue.split(".");r.push(o);var i=r.join(".");e.editableProfile.data[i]=t[o]||null,e.editableProfile.required[i]=(n[o]||{}).required||!1}}),e.editableProfile}t.exports={dictionaryFromKey:e,createDataTemplate:n,flatten:o}}()},{}],22:[function(e,t,n){!function(){"use strict";function e(e){return r[e]=(r[e]||0)+1,r[e]}function n(e){"undefined"==typeof e?r={}:r[e]=0}function o(e){return r[e]||0}var r={};t.exports={reset:n,increment:e,getCount:o}}()},{}],23:[function(e,t,n){!function(){"use strict";function e(e,t){this.start=e,this.end=t}t.exports=e;var n=1e3;e.prototype.getPercentElapsed=function(e){var t;return e instanceof Date?(t=this.end.getTime()-this.start.getTime(),(e.getTime()-this.start.getTime())/t):null},e.prototype.getSecondsRemaining=function(e){return e instanceof Date?(this.end.getTime()-e.getTime())/n:null},e.prototype.getDateAtPercent=function(e){var t=this.end.getTime()-this.start.getTime();return new Date(this.start.getTime()+e*t)},e.prototype.getDateNearestToMultipleOfSeconds=function(e){if(0>=e)return null;var t=(this.end.getTime()-this.start.getTime())/n,o=Math.ceil(t/e)*e;return new Date(this.start.getTime()+o*n)}}()},{}],24:[function(e,t,n){!function(){"use strict";t.exports={TRUST_EXPIRY:18e5,STATES:{low:0,high:1},IGNORED_REAUTH_AUTHENTICATORS:["facebook_token","google_token","amazon_token","gamenetwork"]}}()},{}],25:[function(e,t,n){!function(){"use strict";function e(){return Function("/*@cc_on return 10===document.documentMode@*/")()}function n(){var e=navigator.userAgent.toLowerCase(),t=-1!==e.indexOf("android"),n=-1!==e.indexOf("chrome"),o=-1!==e.indexOf("windows phone");return t&&!n&&!o}t.exports={isIE10:e,isAndroidBrowser:n};!function(){try{for(var e,t=3,n=document.createElement("div"),o=n.getElementsByTagName("i");n.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",o[0];);return t>4?t:e}catch(r){return 0}}()}()},{}],26:[function(e,t,n){!function(){"use strict";function e(e){for(var t=-1,o=0;o<e.length;o++)t=t>>>8^n[255&(t^e.charCodeAt(o))];return(-1^t)>>>0}t.exports=e;var n=function(){for(var e=new Array(256),t=0;t<e.length;t++){for(var n=t,o=0;8>o;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n>>>0}return e}()}()},{}],27:[function(e,t,n){!function(){"use strict";function e(e,t){var n,o=!1;return function(){return o===!1&&(o=!0,n=e.apply(t,arguments)),n}}function n(e,t,n){n="number"!=typeof n?1/0:n;var o=Object.create(null);return function(){var r=[].join.call(arguments,"-");return("undefined"==typeof o[r]||o[r].created+n<Date.now())&&(o[r]={created:Date.now(),value:e.apply(t,arguments)}),o[r].value}}function o(e,t,n){var o,r;return function(){var i=Date.now();return("undefined"==typeof o||i>=o)&&(o=i+n,r=e.apply(t,arguments),setTimeout(function(){o=void 0,r=void 0},n||0)),r}}function r(e,t,n){var o,r;return function(){r=arguments,o||(o=setTimeout(function(){o=null,e.apply(t,r),r=void 0},n))}}t.exports={once:e,memoize:n,debounceLeadingEdge:o,debounce:r}}()},{}],28:[function(e,t,n){!function(){"use strict";function e(){if(!i){i=!0;for(var e=0;e<r.length;e++)r[e].fn.call(window,r[e].ctx);r=[]}}function n(){"complete"===document.readyState&&e()}function o(t,o){return i?void setTimeout(function(){t(o)},1):(r.push({fn:t,ctx:o}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(e,1):s||(document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):(document.attachEvent("onreadystatechange",n),window.attachEvent("onload",e)),s=!0)))}t.exports=o;var r=[],i=!1,s=!1}()},{}],29:[function(e,t,n){!function(){function e(){return["DTSS-DEV.ESPN.WEB","ESPN-AR.WEB","ESPN-CL.WEB","ESPN-CO.WEB","ESPN-COACHES","ESPN-CRICINFO.WEB","ESPN-CRICKETMONTHLY.WEB","ESPN-DEPORTES","ESPN-ESPNAPP.WIN","ESPN-ESPNARCADE","ESPN-ESPNCOM","ESPN-ESPNCONTESTS","ESPN-ESPNRADIO","ESPN-ESPNVIDEO","ESPN-ESPNW","ESPN-FANTASYEPRIZE","ESPN-FANTASYLM","ESPN-FC","ESPN-INSIDER","ESPN-MX.WEB","ESPN-PASS.WEB","ESPN-UK","ESPN-VE.WEB","ESPN-XGAMES.WEB","ESPNCOM-ESPN.REGISTRATION"]}function n(t){var n=(t||"").replace(/(-DEV|-QA|-STAGE|-VALID|-PROD)$/,"");return-1!==e().indexOf(n)}t.exports={isWhitelisted:n,get:e}}()},{}],30:[function(e,t,n){!function(){"use strict";function n(e,t,n){var o,r;for("string"==typeof t&&(t=t.split(".")),o=0,r=t.length-1;r>o;o++)("undefined"==typeof e[t[o]]||null===e[t[o]])&&(e[t[o]]={}),e=e[t[o]];return e[t[r]]=n,e}function o(e,t,n){for(n&&t.match(/^\[(\d+)\]/)&&(t="a"+t,e={a:e}),t=t.split(".");e&&t.length>0;){for(;n&&(""+t[0]).match(/.*\[\d+\]$/);)(""+t[0]).replace(/(.*)\[(\d+)\]$/,function(e,n,o){t.splice(0,1,n,parseInt(o,10))});e=e[t.splice(0,1)]}return 0===t.length?e:void 0}function r(e){var t,n={};return t=e?e.split("?")[1]:window.location.search.substr(1),t&&t.split("&").forEach(function(e){e=e.split("="),n[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}),n}function i(e){var t,n,o=[];for(t in e)e.hasOwnProperty(t)&&e[t]&&(n=encodeURIComponent("object"==typeof e[t]?JSON.stringify(e[t]):e[t]),o.push(t+"="+n));return o.join("&")}function s(e){return e?document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+e+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")||null:null}function a(e,t,n,o,r,i){var s;return!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e)?!1:(s=e+"="+t,r&&r.constructor===Date&&(s+="; expires="+r.toUTCString()),n&&(s+="; domain="+n),o&&(s+="; path="+o),i&&(s+="; secure"),document.cookie=s,!0)}function c(e,t,n){return document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; domain="+t:"")+(n?"; path="+n:""),!0}function u(e,t,n){var o=n.services.guestController.url;if(n.services.guestController.ha&&n.services.guestController.ha.url&&n.services.guestController.ha.support){var r=n.services.guestController.ha.support[e];r&&-1!=r.indexOf(t)&&(o=n.services.guestController.ha.url)}return o}function l(){return d()+d()+"-"+d()+"-"+d("4")+"-"+d((Math.floor(10*Math.random())%4+8).toString(16))+"-"+d()+d()+d()}function d(e){for(var t=Math.floor(65535*Math.random()).toString(16),n=4-t.length;n>0;n--)t="0"+t;return e=(""+e).substring(0,4),!isNaN(parseInt(e,16))&&e.length?e+t.substr(e.length):t}function f(e){if(null===e||"object"!=typeof e)return e;var t=new e.constructor;for(var n in e)e.hasOwnProperty(n)&&(t[n]=f(e[n]));return t}function p(e){if(null!==e&&"object"==typeof e)Object.keys(e).forEach(function(t){e[t]=p(e[t])});else if("string"==typeof e)return e.trim();return e}function g(e){e.parentNode.removeChild(e)}function h(e){var t=[{}].concat([].slice.call(arguments));return b.apply(null,t)}function m(e,t){for(var n=[],o=e.parentNode;o&&o.tagName&&o.getAttribute;)n.push(o),o=o.parentNode;return n.filter(function(e){return e.classList.contains(t)})[0]}function v(e,t,n,o){n=void 0===n?/\s+/:n;var r,i=(o&&o.ownerDocument||document).createDocumentFragment(),s=t.split(n).map(function(t){return(o||document.body).querySelector(e+" [sequenceKey="+t+"]")}).filter(function(e){return e});s.forEach(function(e,t,n){var o;e&&(r=r||e.parentNode,e===n[n.length-1]&&r&&(o=document.createTextNode(" "),r.replaceChild(o,e)),i.appendChild(e),o&&o.parentNode&&o.parentNode.replaceChild(i,o))})}function b(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t,n=Object(e),o=!1,r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i){for(var s=Object.keys(Object(i)),a=0,c=s.length;c>a;a++){var u=s[a];try{var l=Object.getOwnPropertyDescriptor(i,u);void 0!==l&&l.enumerable&&(n[u]=i[u])}catch(d){o||(o=!0,t=d)}}if(o)throw t}}return n}function y(e,t){var n=Array.isArray(t),o=n&&[]||{};return n?(e=e||[],o=o.concat(e),t.forEach(function(t,n){"undefined"==typeof o[n]?o[n]=t:"object"==typeof t?o[n]=deepmerge(e[n],t):-1===e.indexOf(t)&&o.push(t)})):(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){o[t]=e[t]}),Object.keys(t).forEach(function(n){o[n]="object"==typeof t[n]&&t[n]&&e[n]?deepmerge(e[n],t[n]):t[n]})),o}function I(e,t){var n=new Date(e);return isNaN(parseInt(t,10))||0>t||!(e instanceof Date)?null:(n.setSeconds(e.getSeconds()+t),n)}function E(e){return e instanceof Date&&!isNaN(e.getTime())}function w(){var e=[],t=e.push;e.push=e.unshift=e.splice=function(){throw"not yet implemented for uniqueArray"};var n=function(t){return-1===e.indexOf(t)};return e.addOnce=function(o,r){return n(o)&&(t.call(e,o),"function"==typeof r&&r()),e.length},e}function _(e,t){var n={};for(var o in t)if(t.hasOwnProperty(o)){null!==e&&"object"==typeof e&&e.hasOwnProperty(o)||(n[o]=t[o]);var r=null!==t[o]&&null!==e[o]&&!Array.isArray(t[o])&&!Array.isArray(e[o])&&"object"==typeof t[o]&&"object"==typeof e[o];if(r){var i=_(e[o],t[o]);Object.keys(i).length>0&&(n[o]=i)}else(e[o]!==t[o]||Array.isArray(t[o]))&&(n[o]=t[o]);null===e[o]&&""===t[o]&&delete n[o]}return n}function S(e){return Array.isArray(e)?e.forEach(S):null!==e&&"object"==typeof e&&Object.keys(e).forEach(function(t){"$"===t[0]?delete e[t]:S(e[t])}),e}function N(e,t){e.attr("tabindex","0"),e.on("keypress",function(e){(32===e.keyCode||13===e.keyCode)&&t(e)})}function T(){try{return new z(navigator.userAgent).getOS()}catch(e){return navigator.platform}}function O(){return/(iphone|ipod|ipad).* os 8_/.test(navigator.userAgent.toLowerCase())}function k(){var e="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return window.devicePixelRatio>1||window.matchMedia&&window.matchMedia(e).matches}function A(e){return o(e,"uiConfig.audience")||o(e,"uiConfig.adultAudience")}function D(e){var t=A(e);return"string"==typeof t?"FF"===t:!t}function L(e){return"PK"===o(e,"uiConfig.audience")}function R(e){var t=o(e,"uiConfig.showDOB"),n=o(e,"uiConfig.adultAudience");return L(e)?!1:"undefined"!=typeof t?t:!n}function C(e){return{category:e.keyCategory,codes:(e.errors||[]).map(function(e){return e.code}).join(",")}}function x(e){return j(e,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")}function j(e,t){return e&&(e.errors||[]).some(function(e){return e.code===t})}function P(e){e=e||{};var t=[];return Object.keys(e).forEach(function(n){var o=n;if(e[n]){var r=Array.isArray(e[n])?e[n].join(","):e[n].toString();o+="("+r+")"}t.push(o)}),t.join(",")}function B(){function e(e,o,r){e.classList.add("no-animate"),e.style.height=n(e)+"px",setTimeout(function(){e.classList.remove("no-animate"),(r||function(){})()},0),o&&setTimeout(function(){t(e)},o)}function t(e){e.classList.add("no-animate"),e.style.height=null,setTimeout(function(){e.classList.remove("no-animate")},0)}function n(e){var t=e.offsetHeight;return t||(e.classList.add("state-calculating"),t=e.offsetHeight,e.classList.remove("state-calculating")),t}return{lock:e,unlock:t,measure:n}}function U(e){return"string"==typeof e?e.substring(0,6)+"...":""}function G(e){return o(e,"clientInfo.carbonDomain")||"Disney"}function F(e){var t={"AM-FACEBOOK":"facebook","AM-GOOGLE":"google"};return t[e]}function M(e){return["AM-FACEBOOK","AM-GOOGLE"].some(function(t){return o(e,[t,"enabled"].join("."))===!0})}function H(e,t){var n,o,r=this,i=function(){};i.prototype=this.prototype,n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return r.apply(this,arguments)};for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);if(t)for(o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);if(n.prototype=new i,n.__super__=r.prototype,e)for(o in e)e.hasOwnProperty(o)&&(n.prototype[o]=e[o]);return n.prototype.constructor=n,n}function V(e){var t=e.match(/[^.]+(?:\.com?(?:\.[a-z]{2})?|(?:\.[a-z]+))?$/i);return t&&t.length?t[0]:void 0}function q(e){return null!==e&&"object"==typeof e}function W(){var e=""+window.location.hostname,t=e.split("."),n=V(e),o=[];for(o.push(e);e!==n;)t.shift(),e=t.join("."),o.push(e);return o}function K(e){return Math.random()<=e}var z=e("../../../../assets/common/js/ua-parser"),Y=e("./browser-detection");t.exports={set:n,get:o,getQueryStringParams:r,buildQueryString:i,getCookie:s,setCookie:a,deleteCookie:c,getGuestControllerBaseUrl:u,uuid:l,clone:f,deepTrim:p,removeNode:g,immutableAssign:h,getParentByClassName:m,reorderElements:v,assign:b,merge:y,expires:I,isValidDate:E,uniqueArray:w,objectDiff:_,filterAngularProperties:S,makeElementAccessible:N,crc32:e("./crc32"),isEspnClientId:e("./espn-whitelist").isWhitelisted,getEspnWhitelist:e("./espn-whitelist").get,curry:e("./curry"),promise:e("./promise"),url:e("./url"),isIE10:Y.isIE10,isAndroidBrowser:Y.isAndroidBrowser,getOS:T,isIOS8:O,isRetina:k,isFamilyFriendly:D,isPrimaryKid:L,getAudience:A,showDob:R,docReady:e("./doc-ready"),getErrorCodesAndCategory:C,containsInvalidAccessTokenError:x,containsErrorCode:j,formatLogInfoBlock:P,maskToken:U,getCarbonDomain:G,getSocialProviderFromNamespace:F,isSocialEnabled:M,heightHelper:B(),extend:H,getTLD:V,isObject:q,getCookieDomains:W,randomChance:K}}()},{"../../../../assets/common/js/ua-parser":3,"./browser-detection":25,"./crc32":26,"./curry":27,"./doc-ready":28,"./espn-whitelist":29,"./promise":31,"./url":32}],31:[function(e,t,n){!function(){"use strict";function e(e,t){e.then(t,t)}function n(e,t){var n=[].slice.call(arguments,2);setTimeout(function(){e.reject.apply(e,n)},t)}function o(e,t,n){var o=null;return n="number"!=typeof n?0:n,function(){return null===o&&(o=e.apply(t,arguments),o["finally"](function(){setTimeout(function(){o=null},n)})),o}}t.exports={complete:e,timeout:n,cache:o}}()},{}],32:[function(e,t,n){!function(){"use strict";function e(e){return function(t){return n.href=t,n[e]}}var n=document.createElement("a");t.exports={getHostName:e("hostname")}}()},{}],33:[function(e,t,n){!function(){"use strict";function e(){return o}function n(e){return-1!==o.indexOf(e)}t.exports={get:e,isValid:n};var o=["ar-XX","da-DK","de-DE","en-AU","en-US","es-ES","es-LA","fi-FI","fr-FR","id-ID","it-IT","ja-JP","ko-KR","ms-MY","nl-NL","nn-NO","pl-PL","pt-BR","ru-RU","sv-SE","th-TH","tl-PH","vi-VN","zh-CN","zh-HK"]}()},{}],34:[function(e,t,n){"use strict";var o=e("./config"),r=e("logger"),i=e("messages").getInstance(),s=e("./metricsUtil"),a=e("utils");t.exports=function(){i.subscribe("metrics.log.send",function(e){var t=a.clone(e);s.throttle(t.action_name)||s.processLog(t).then(function(e){e=s.removeInvalidFields(e);var t=s.hasAllRequiredFields(e);t.valid?o.options.handleSendLogs(e):Array.isArray(t.missing)&&r.error('Missing required fields "'+t.missing.join(", ")+'"')})})}},{"./config":36,"./metricsUtil":40,logger:12,messages:13,utils:30}],35:[function(e,t,n){"use strict";function o(e,t){"string"==typeof e?s(u.immutableAssign({action_name:e,success:!0},u.clone(t||{}))):a.error("Action name is required and not provided or invalid")}function r(e,t){"string"==typeof e?s(u.immutableAssign({action_name:e,success:!1},u.clone(t||{}))):a.error("Action name is required and not provided or invalid")}function i(e,t){c.publish("metrics.log.send",e,t)}function s(e){c.publish("metrics.log.send",e)}var a=e("logger"),c=e("messages").getInstance(),u=e("utils");t.exports={log:o,error:r,send:i}},{logger:12,messages:13,utils:30}],36:[function(e,t,n){"use strict";t.exports={webLogUrl:"//log.go.com/log",attributes:{},options:{handleSendLogs:function(){}}}},{}],37:[function(e,t,n){"use strict";t.exports={codes:{NOT_INITIALIZED:{category:"FAILURE_BY_DESIGN",code:"ONEID_NOT_YET_INITIALIZED"},SESSION_NOT_ESTABLISHED:{category:"FAILURE_BY_DESIGN",code:"SESSION_NOT_ESTABLISHED"},READ_TOKEN_FAILURE:{category:"UNKNOWN_ERROR",code:"READ_TOKEN_FAILURE"},UNKNOWN:{category:"UNKNOWN",code:"UNKNOWN_ERROR"}},throttling:{"api:setdonotdisturb":2,"api:getactivitystatus":2,"api:getguestdata":2,"api:getguestnewsletters":2,"api:getloggedin":2,"api:gettruststatestatus":2,"api:init":2,"event:init":2},actions:{api:{forceTokenRefresh:"api:forcetokenrefresh",getActivityStatus:"api:getactivitystatus",getEditableProfileFields:"api:geteditableprofilefields",getGuest:"api:getguestdata",getGuestNewsletters:"api:getguestnewsletters",getLoggedInStatus:"api:getloggedin",getTrustStateStatus:"api:gettruststatestatus",init:"api:init",launchDisplayName:"api:launch:displayname",launchLicensePlate:"api:launch:licenseplate",launchLogin:"api:launch:login",launchNewsletters:"api:launch:newsletters",launchProfile:"api:launch:profile",launchReauth:"api:launch:reauth",launchRecoverUsername:"api:launch:recoverusername",launchRegistration:"api:launch:registration",launchRequestActivity:"api:launch:requestactivity",launchResetPassword:"api:launch:resetpassword",launchSocialRegistration:"api:launch:socialregistration",launchNetworkConnect:"api:launch:networkconnect",logout:"api:logout",redeemLicensePlateCode:"api:redeemlicenseplatecode",setDoNotDisturb:"api:setdonotdisturb",setEditableProfileFields:"api:seteditableprofilefields"},event:{preinit:"event:preinit",create:"event:create",createFB:"event:create:fb",createGP:"event:create:gp",deactivateAccount:"event:deactivateaccount",init:"event:init",licensePlateRedeemed:"event:licenseplateredeemed",login:"event:login",loginBlue:"event:login:blue",loginObo:"event:login:obo",loginFB:"event:login:fb",loginGP:"event:login:gp",logout:"event:logout",logoutAccountDeactivated:"event:logout:accountdeactivated",logoutApi:"event:logout:api",logoutGetGuest:"event:logout:getguest",logoutInit:"event:logout:init",logoutInOtherTab:"event:logout:loggedoutinothertab",logoutInvalidAccessAndRefreshToken:"event:logout:invalidaccessandrefreshtoken",logoutInvalidRefreshToken:"event:logout:invalidrefreshtoken",logoutPasswordAttemptsFailed:"event:logout:passwordattemptsfailed",logoutReauthChangeAccount:"event:logout:reauthchangeaccount",logoutRefreshFailed:"event:logout:refreshfailed",logoutTokenDataDeleted:"event:logout:tokendatadeleted",logoutUnknown:"event:logout:unknown",migration:"event:migration",optIn:"event:optin",ppu:"event:ppu",reauth:"event:reauth",resetPassword:"event:resetpassword",recoverUsername:"event:recoverusername",refresh:"event:refresh",serviceError:"event:serviceerror",tokenRefresh:"event:token:refresh",update:"event:update",updateAddress:"event:update:address",updateDisplayName:"event:update:displayname",updatePPU:"event:update:ppu"}},validLogFields:["action_name","anon","appid","client_id","connection_type","conversation_id","correlation_id","direct_flow_version","error_category","error_codes","info","make_model","os","process_time","sdk_version","success","swid","timestamp","user_agent"],requiredLogFields:["action_name","anon","client_id","appid","success","swid","timestamp"]}},{}],38:[function(e,t,n){"use strict";var o=e("./constants"),r=e("./attatchSubscribers"),i=e("exceptions"),s=e("./init"),a=e("./timed"),c=e("./basicLogTypes"),u=e("./config");t.exports={init:s,actions:o.actions,codes:o.codes,attachSubscribers:r,getErrorCodes:i.getErrorCodes,error:c.error,log:c.log,send:c.send,timed:a,setWebLogUrl:function(e){u.webLogUrl=e},setClientId:function(e){u.attributes.client_id=e}}},{"./attatchSubscribers":34,"./basicLogTypes":35,"./config":36,"./constants":37,"./init":39,"./timed":42,exceptions:11}],39:[function(e,t,n){"use strict";var o=e("./config"),r=e("utils");t.exports=function(e,t){r.assign(o.attributes,e),"function"==typeof t&&(o.options.handleSendLogs=t)}},{"./config":36,utils:30}],40:[function(e,t,n){"use strict";function o(e){e=("string"==typeof e?e:"").toLowerCase();var t=c.throttling[e];return"number"==typeof t?!f.randomChance(t/100):!1}function r(e){var t=f.immutableAssign(a.attributes||{},e);t.hasOwnProperty("error_codes")&&"string"!=typeof t.error_codes&&(t.error_codes=c.codes.UNKNOWN.code,t.error_category||(t.error_category=c.codes.UNKNOWN.category)),t.error_codes&&(t.error_codes=t.error_codes.replace(/\s/g,"_"),t.error_category||(t.error_category="FAILURE_BY_DESIGN")),"number"!=typeof t.process_time&&(t.process_time=1),"boolean"!=typeof t.success&&(t.success=!0),t.success=t.success.toString(),t.timestamp=(new Date).toISOString(),t.conversation_id=t.conversation_id||f.uuid(),t.correlation_id=t.correlation_id||f.uuid();var n=d.defer(),o=d.defer();return l.publish("token.read",null,n),l.publish("swid.read",null,o),d.allSettled([n.promise,o.promise]).spread(function(e,n){return"string"!=typeof t.swid&&(t.swid="rejected"===e.state?n.value.swid:e.value.token.swid),"boolean"!=typeof t.anon&&(t.anon=!/{/.test(t.swid)),t.anon=t.anon.toString(),(t.action_name===c.actions.event.refresh||0===t.action_name.indexOf("log:"))&&(t.info=f.immutableAssign({cookieLength:n.cookieLength},t.info||{})),f.isObject(t.info)&&(t.info=f.formatLogInfoBlock(t.info)),t})}function i(e){if(!f.isObject(e)&&!Array.isArray(e))return e;var t=Object.keys(e).reduce(function(t,n){var o=e[n];return-1===c.validLogFields.indexOf(n)?t.invalid.push(n):t.valid[n]=o,t},{valid:{},invalid:[]});return t.invalid.length>0&&u.error("Invalid fields: {"+t.invalid.join(", ")+"} are not allowed in a metrics log."),t.valid}function s(e){if(!f.isObject(e)&&!Array.isArray(e))return{valid:!1,missing:[]};var t=c.requiredLogFields.reduce(function(t,n){return e.hasOwnProperty(n)||t.push(n),t},[]);return{valid:0===t.length,missing:t}}var a=e("./config"),c=e("./constants"),u=(e("../outer/environment"),e("logger")),l=e("messages").getInstance(),d=e("q"),f=e("utils");t.exports={throttle:o,processLog:r,removeInvalidFields:i,hasAllRequiredFields:s}},{"../outer/environment":48,"./config":36,"./constants":37,logger:12,messages:13,q:1,utils:30}],41:[function(e,t,n){"use strict";{var o=(e("utils"),e("../config"));e("../constants")}t.exports=function(e){var t=Object.keys(e).reduce(function(t,n){var o=e[n];return"object"==typeof val&&(o=JSON.stringify(o)),t.push(n+"="+encodeURIComponent(o)),t},[]).sort().join("&"),n=o.webLogUrl+"?"+t,r=new XMLHttpRequest;r.open("GET",n),r.withCredentials=!0,r.send(null)}},{"../config":36,"../constants":37,utils:30}],42:[function(e,t,n){"use strict";var o=e("./basicLogTypes"),r=e("utils");t.exports=function(e,t,n){var i=r.isObject(t)?t:{},s="number"==typeof n?n:Date.now();return{error:function(t){"string"==typeof e?(i.process_time=Date.now()-s,o.error(e,r.immutableAssign(i,t||{}))):logger.error('Invalid action name "'+e+'." Must be type string.')},send:function(t,n){"string"==typeof e?(i.process_time=Date.now()-s,("boolean"==typeof n?n:!0)?o.log(e,r.immutableAssign(i,t||{})):o.error(e,r.immutableAssign(i,t||{}))):logger.error('Invalid action name "'+e+'." Must be type string.')},success:function(t){"string"==typeof e?(i.process_time=Date.now()-s,o.log(e,r.immutableAssign(i,t||{}))):logger.error('Invalid action name "'+e+'." Must be type string.')}}}},{"./basicLogTypes":35,utils:30}],43:[function(e,t,n){!function(){"use strict";function n(){c.log("AgebandCountryCookie#read");var e=u.read(i())||"",t=l[e.substring(0,1)],n=e.substring(1);return e&&t&&n?{ageBand:t,countryCode:n}:null}function o(e){c.log("AgebandCountryCookie#write");var t,n=d[s.get(e,"profile.ageBand")||""],o=s.get(e,"profile.region")||s.get(e,"profile.countryCodeDetected"),r=n+o;return n&&o?(t=new Date,t.setFullYear(t.getFullYear()+33),u.write(i(),r,a.getCookieDomain(),"/",t,!1),!0):(c.debug("Failed to write country/ageband cookie"),!1)}function r(){c.log("AgebandCountryCookie#remove"),u.remove(i(),a.getCookieDomain(),"/")}function i(){return a.getClientId()+"-ac"}t.exports={read:n,write:o,remove:r};var s=e("utils"),a=e("../environment"),c=e("logger"),u=e("cookie"),l={X:"ADULT",Y:"TEEN",Z:"CHILD"},d={ADULT:"X",TEEN:"Y",CHILD:"Z"}}()},{"../environment":48,cookie:6,logger:12,utils:30}],44:[function(e,t,n){!function(){"use strict";t.exports={AGEBAND_TIMEOUT:18e5,AGEBAND_DATA_SUFFIX:".ab2"}}()},{}],45:[function(e,t,n){!function(){"use strict";function n(e){var t=I.get(e.site,"uiConfig.cagoots.interval"),n=I.get(e.site,"uiConfig.cagoots.enabled");"undefined"==typeof n&&(n=!0),g.debug("CaGOOTS interval: "+(t||O)+" minutes"),d=(t||O)*N,w.resolve()}function o(){g.log("Cagoots#startTimer");var e=h.defer(),t=new Date(Date.now());return w.promise.then(function(){b.getToken().then(function(n){r(n,t,e)})}),e.promise}function r(e,t,n){g.log("Cagoots#scheduleCheck");var o,r,i,a,c=new Date(I.get(e,"token.lastChecked")||I.get(e,"token.created")),u=new v(e.token);return c instanceof Date||(c=t),i=l(c,t,d)*S,o=u.getNextRefreshAttempt(t,y),r=new Date(t.getTime()+i),a=(o.date.getTime()-r.getTime())/S,T>a&&a>=0?(g.debug("Attempted to schedule a CaGOOTS check but aborted due to the next token refresh happening at the same time."),g.debug("Next token refresh:"),g.debug(o),g.debug("Next CaGOOTS check:"),g.debug(r),g.debug("Delta (seconds): "+a),g.debug("Threshold (seconds): "+T),p.publish("cagoots.aborted",{reason:"token_refresh_overlap"}),void n.reject()):(g.debug("CaGOOTS check to happen in "+Math.floor(i/S/60)+" minutes "+(i/S%60).toFixed()+" seconds"),clearTimeout(f),f=setTimeout(function(){b.getToken().then(function(e){s(e,t)}),_++},i),void n.resolve(i))}function i(){clearTimeout(f)}function s(e,t){g.log("Cagoots#checkCagoots");var n,o,r,i=h.defer();if(!isNaN(Date.parse(e.token.created))&&!isNaN(Date.parse(e.token.expires))){if(n=new Date(e.token.created),o=new Date(e.token.expires),r=new m(n,o),r.getPercentElapsed(t)>=1)return p.publish("cagoots.aborted",{reason:"token_expired"}),void g.debug("Token is expired - aborting CaGOOTS check");g.debug("Attempting CaGOOTS check"),p.publish("cagoots.check",e,i),i.promise.then(a).fail(c)}}function a(){g.log("Cagoots#handleCheckSuccess"),u()}function c(e){g.log("Cagoots#handleCheckError");var t=I.get(e,"response.error.errors")||[],n=t.reduce(function(e,t){return e.push(t.code),e},[]),o=b.getState(),r=I.get(e,"token.access_token"),i=n.indexOf("AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")>-1?r:r.slice(0,6)+"...";E.log("log:checkauthorization",{error_category:I.get(e,"response.error.keyCategory"),error_codes:n.join(","),info:{session:o,token:i,ttl:Date.parse(I.get(e,"token.expires"))-Date.now(),attempt:_}}),u()}function u(){g.log("Cagoots#updateLastChecked");var e=h.defer(),t=h.defer(),n=new Date;p.publish("session.updatelastchecked",null,e),e.promise.then(function(){p.publish("token.read",null,t),t.promise.then(function(e){o({guest:e,token:e.token},n)})})}function l(e,t,n){var o=e.getTime()/S+n,r=o-t.getTime()/S;return 0>r?0:r}var d,f,p=e("../../common/messages").getInstance(),g=e("logger"),h=e("../../../../assets/common/js/q"),m=e("../../common/time-span"),v=e("../../outer/token"),b=e("../session/session"),y=e("../../common/retry-counter"),I=e("../../common/utils/"),E=e("metrics"),w=h.defer(),_=0;t.exports={init:n,startTimer:o,notifyLogout:i,getTimeoutSeconds:l};var S=1e3,N=60,T=60,O=1440}()},{"../../../../assets/common/js/q":1,"../../common/messages":13,"../../common/retry-counter":22,"../../common/time-span":23,"../../common/utils/":30,"../../outer/token":65,"../session/session":63,logger:12,metrics:38}],46:[function(e,t,n){!function(){"use strict";function t(e){o.startTimer(e)}var n=e("../../common/messages").getInstance(),o=e("./cagoots");n.subscribe("token.refreshed",t),n.subscribe("session.loggedin",t),n.subscribe("session.reestablished",t),n.subscribe("config.ready",o.init),n.subscribe("session.delete",o.notifyLogout)}()},{"../../common/messages":13,"./cagoots":45}],47:[function(e,t,n){!function(){"use strict";function n(){var e=o.defer();return r.publish("siteconfig.read",null,e),i.promise.timeout(e,9e4),e.promise}var o=e("../../../../assets/common/js/q"),r=e("messages").getInstance(),i=e("utils");t.exports={getSite:n}}()},{"../../../../assets/common/js/q":1,messages:13,utils:30}],48:[function(e,t,n){!function(){"use strict";function n(e,t){var n;O.assign(C,e),C.isDirectFlow=!!O.get(t,"isDirectFlow"),S=e.origin||(document.querySelector('script[src$="/outer/DisneyID.js"]')||{}).src||(document.getElementById("disneyid-script")||{}).src||document.location.href,C.environment=A.getEnvironmentFromUrl(S),n=O.url.getHostName(S),E=y(p()),w=-1===location.protocol.toLowerCase().indexOf("https")?"http":"https",C.cookieDomain?_=C.cookieDomain:e.responderPage&&(_=b(C.outerDomain,O.url.getHostName(e.responderPage))),N=!!C.blueCookie,T.subscribe("env.correlation.read",function(e,t){t.resolve(C.correlationId)})}function o(){return E}function r(){return w}function i(){return C.environment}function s(){return N}function a(){return"undefined"==typeof C.clientId||A.clientIdHasSuffix(C.clientId)?C.clientId:[C.clientId,A.getClientIdEnvironment(i())].join("-")}function c(){return A.getClientIdEnvironment(i())}function u(){return C.correlationId}function l(e){C.correlationId=e}function d(){return C.correlationIdTimeStamp}function f(){return C.langPref}function p(){function e(e,t){var n=t[e];try{delete t[e]}catch(o){}return n}var t=O.clone(g()),n=e("clientId",t),o=e("langPref",t),r=e("l10nContent",t),i=r?"content="+r+"&":"",s=S.replace("outer/DisneyID.js",n+"/"+o+"?include=config,l10n,js,html&"+i)+O.buildQueryString(t);return L.debug("Lightbox Path: "+s),L.debug("Lightbox Params",t),s}function g(){var e,t=A.getClientIdEnvironment(i());e="STAGE"===t?"STG":"VALID"===t?"VAL":t;var n=O.assign({clientId:a(),scheme:window.location.protocol.replace(":",""),postMessageOrigin:location.href,cookieDomain:_,config:e,logLevel:L.getLogLevel(),topHost:document.location.host||""},D.read()||{});
["l10nContent","langPref","countryPref","continentPref","cssOverride","debug","responderPage","successPageAfterCreate","siteURL"].forEach(function(e){C[e]&&(n[e]=C[e])});var o=k.getCountry();o&&(n.countryCode=o);var r=k.getGeoIP();return r&&(n.geoIP=r),n.buildId=R,n}function h(e,t){var n,o,r={};return(e=e||C.responderPage)?(O.assign(r,O.getQueryStringParams(e),g(),t||{}),n=e.match(/(^[^\?]*)?(\?[^#]*)?(#.*$)?/),o=n[1]+"?",o+=O.buildQueryString(r),n[3]&&(o+=n[3]),o):void 0}function m(){return C.migrationResponderPage?h(C.migrationResponderPage,{"espn-migration":!0}):void 0}function v(){return _}function b(e,t){for(var n=e.split(".").reverse(),o=t.split(".").reverse(),r=[],i=0;i<Math.min(n.length,o.length)&&n[i]===o[i];i++)r.push(n[i]);return r.length>1?r.reverse().join("."):null}function y(e){var t=document.createElement("a");return t.setAttribute("href",e),t.protocol+"//"+t.host}function I(){return C.isDirectFlow}t.exports={init:n,getOrigin:o,getProtocol:r,getPath:p,getClientId:a,setCorrelationId:l,getClientIdEnvSuffix:c,getCorrelationId:u,getCorrelationIdTimeStamp:d,getCookieDomain:v,getLangPref:f,getResponderPageUrl:h,getMigrationResponderPageUrl:m,blueCookieEnabled:s,getStandardQueryParams:g,isDirectFlow:I};var E,w,_,S,N,T=e("messages").getInstance(),O=e("../common/utils"),k=e("debug"),A=e("../common/environment-helper"),D=e("./ageband-country-cookie"),L=e("logger"),R=e("../common/build-identifier"),C={langPref:"en-US"}}()},{"../common/build-identifier":5,"../common/environment-helper":8,"../common/utils":30,"./ageband-country-cookie":43,debug:7,logger:12,messages:13}],49:[function(e,t,n){!function(){"use strict";function n(e){return f.log("espn/migration#init"),m++,m>1?(2===m&&g.error("log:migration.responder.mismatch",{client_id:e.clientId}),!1):(b=l.subscribe("migration.session.found",function(t){f.debug("OneID session found by migration responder"),r(t,e.cookieDomain,e.onMigrationSuccess)}),y=l.subscribe("migration.session.notfound",function(t){if(f.debug("OneID session not found by migration responder"),t&&t.navy){var n=p.defer();f.debug("NAVY cookie found. Attempting to reconstitute session.");var o=d.getTLD(""+window.location.hostname),r=new Date;r.setFullYear(r.getFullYear()+1),h.write("oidNAVY",t.navy,"."+o,"/",r,!1),l.publish("bluecookie.authenticate",{blue:t.navy},n),n.promise.then(function(){e.onMigrationSuccess()},function(){e.onMigrationFailure()})}else e.onMigrationFailure()}),void o(e.responderPage))}function o(e){u=document.createElement("iframe"),u.setAttribute("id","disneyid-secure-migration-responder"),u.setAttribute("name","disneyid-secure-migration-responder"),u.setAttribute("src",e),u.style.display="none",document.body.appendChild(u)}function r(e,t,n){f.log("espn/migration#handleSessionFound");var o=(p.defer(),p.defer(),new Date);v=!0,o.setFullYear(o.getFullYear()+33),Object.keys(e.cookies).forEach(function(n){var r=n.indexOf(".token")>-1||n.indexOf(".idn")>-1,i=n.toLowerCase().indexOf("swid")>-1||n.indexOf("oidNAVY")>-1?d.getTLD(window.location.hostname):t;"swid"===n.toLowerCase()&&(c=e.cookies[n]),h.write(n,e.cookies[n],i,"/",o,r)}),f.debug("OneID session cookies copied to ."+t),n()}function i(){return v}function s(){return c}function a(){u&&u.parentElement&&u.parentElement.removeChild(u),v=!1,m=0,b(),y()}var c,u,l=e("messages").getInstance(),d=e("../../../common/utils"),f=e("logger"),p=e("q"),g=e("metrics"),h=e("cookie"),m=0,v=!1,b=function(){},y=function(){};t.exports={init:n,isMigratingSession:i,getSwid:s,cleanup:a}}()},{"../../../common/utils":30,cookie:6,logger:12,messages:13,metrics:38,q:1}],50:[function(e,t,n){!function(){"use strict";function e(e){var t="",n=e[0];return e.substr(1).split("").forEach(function(e){e!==n[0]?(t+=n.length>2?n.length+n[0]:n,n=e):n+=e}),t+=n.length>2?n.length+n[0]:n}function n(e){var t,n,o,r="",i=e.split(/(\d+)/),s=i.length;for(t=0;s>t;t++)if(o=parseInt(i[t],10),isNaN(o))r+=i[t];else{for(n=0;o>n;n++)r+=i[t+1][0];r+=i[t+1].substr(1),t++}return r}t.exports={compress:e,decompress:n}}()},{}],51:[function(e,t,n){!function(){"use strict";function n(e,t){var n;if(e&&t&&t.key&&t.type&&(n=E.get(e,t.key),"undefined"!=typeof n&&null!==n)){switch(t.type){case y.type.STRING:n=a(n);break;case y.type.DATE:n=u(n);break;case y.type.INT:n=r(n);break;case y.type.BOOLEAN:n=v(n);break;case y.type.ENUM:n=h(n,t.values);break;case y.type.UUID:n=d(n);break;case y.type.LIST:n=p(n,t.schema);break;default:n=a(n)}return n}}function o(e,t){if(""===e)return null;switch(t.type){case y.type.STRING:e=c(e);break;case y.type.DATE:e=l(e);break;case y.type.INT:e=i(e);break;case y.type.BOOLEAN:e=b(e);break;case y.type.ENUM:e=m(e,t.values);break;case y.type.UUID:e=f(e);break;case y.type.LIST:e=g(e,t.schema)}return e}function r(e){var t="";if(e=parseInt(e,10),!isNaN(e)){if(0===e)return I.charAt(0);for(0>e&&(t=I.delimiter.NEGATIVE,e*=-1);e>0;){var n=Math.floor(e/I.base),o=e-n*I.base;t+=I.charAt(o),e=n}return t}}function i(e){var t=0,n=1,o=1;return e=(e||"").split(""),0!==e.length?(e[0]===I.delimiter.NEGATIVE&&(n=-1,e.splice(0,1)),e.forEach(function(e){t+=I.indexOf(e)*o,o*=I.base}),t*n):void 0}function s(e,t){for(var n=0;t>n;n++)e+=I.charAt(0);return e}function a(e){var t,n="";if("undefined"!=typeof e&&null!==e)return(""+e).split("").forEach(function(e){t=r(e.charCodeAt()-32),2===t.length?t=I.delimiter.DOUBLE_CHAR+t:3===t.length&&(t=I.delimiter.TRIPLE_CHAR+t),n+=t}),n}function c(e){var t,n=0,o=e.length,r="";if(0!==o){for(;o>n;){switch(e[n]){case I.delimiter.DOUBLE_CHAR:t=2,n++;break;case I.delimiter.TRIPLE_CHAR:t=3,n++;break;default:t=1}r+=String.fromCharCode(i(e.substr(n,t))+32),n+=t}return r}}function u(e){return"[object Date]"!==Object.prototype.toString.call(e)&&(e=new Date(e)),r(e.getTime())}function l(e){return e=i(e),e?new Date(e):void 0}function d(e){var t,n="",o="",i=8;if("[object String]"!==Object.prototype.toString.call(e)||!w.test(e))return a(e);o+=/^{[^}]*}$/.test(e)?"1":"0",o+=/[A-F]/.test(e)?"1":"0",e=e.replace(/[{\-}]/g,""),t=Math.floor(e.length/i);for(var c=0;t>c;c++){var u=e.substr(c*i,i),l=parseInt(u,16),d=r(l);n+=s(d,6-d.length)}return""+I.charAt(parseInt(o,2))+n}function f(e){var t,n=parseInt(I.indexOf(e[0]),10),o=!1,r=!1,s="",a=6,u=e;isNaN(n)||(n=n.toString(2),n.length<2&&(n="0"+n),o="1"===n[0],r="1"===n[1],e=e.substring(1)),t=Math.floor(e.length/a);for(var l=0;t>l;l++){for(var d=e.substr(l*a,a),f=i(d),p=f.toString(16);p.length<8;)p="0"+p;s+=p}s=r?s.toUpperCase():s.toLowerCase();var g=(o?"{":"")+s.substring(0,8)+"-"+s.substring(8,12)+"-"+s.substring(12,16)+"-"+s.substring(16,20)+"-"+s.substring(20)+(o?"}":"");return w.test(g)?g:c(u)}function p(e,t){var o=[];return t&&"[object Array]"===Object.prototype.toString.call(e)&&"[object Array]"===Object.prototype.toString.call(t)?(e.forEach(function(e){t.forEach(function(t){o.push(n(e,t))})}),o.join(I.delimiter.LIST)):""}function g(e,t){var n,r=t.length,i=[],s={};return e=e.split(I.delimiter.LIST),e.length?(e.forEach(function(e,a){n=t[a%r],e=o(e,n),"undefined"!=typeof e&&null!==e&&E.set(s,n.key,e),(a+1)%r===0&&(i.push(s),s={})}),i):void 0}function h(e,t){return t&&"undefined"!=typeof t[e]?r(t[e]):void 0}function m(e,t){var n,o=i(e);for(n in t)if(t.hasOwnProperty(n)&&t[n]===o)return n}function v(e){if("true"===e||"1"===e||e===!0||1===e)e=1;else{if("false"!==e&&"0"!==e&&e!==!1&&0!==e)return;e=0}return r(e)}function b(e){var t=i(e);return 1===t}var y=e("./schema"),I=e("./map"),E=e("utils"),w=/^{?[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}}?$/;t.exports={encodeVal:n,decodeVal:o}}()},{"./map":53,"./schema":54,utils:30}],52:[function(e,t,n){!function(){"use strict";function n(e,t){return s(e,f.guest,t)}function o(e){return a(e,f.guest)}function r(e,t){return s(e,f.token,t)}function i(e){return a(e,f.token)}function s(e,t,n){var o;return n=n||t.currentVersion,(o=t.versions[n])?g.compress(n+d.delimiter.VERSION+c(e,o)):void 0}function a(e,t){var n,o;if(e=e.split(d.delimiter.VERSION),n=e[0],o=t.versions[n]){try{e=g.decompress(e[1])}catch(r){return}if(e)try{return u(e,o)}catch(r){}}}function c(e,t){return t.map(function(t){return p.encodeVal(e,t)}).join(d.delimiter.TOP)}function u(e,t){var n={};return e.split("|").forEach(function(e,o){l.set(n,t[o].key,p.decodeVal(e,t[o]))}),n}t.exports={encodeGuest:n,decodeGuest:o,encodeToken:r,decodeToken:i};var l=e("../../common/utils"),d=e("./map"),f=e("./schema"),p=e("./encoding"),g=e("./compression")}()},{"../../common/utils":30,"./compression":50,"./encoding":51,"./map":53,"./schema":54}],53:[function(e,t,n){!function(){"use strict";function e(e){return o.charAt(e)}function n(e){return o.indexOf(e)}var o=" !\"%&'()*+./<>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{}~",r={TOP:"|",LIST:":",VERSION:"=",DOUBLE_CHAR:"#",TRIPLE_CHAR:"$",NEGATIVE:"-"};t.exports={delimiter:r,base:o.length,charAt:e,indexOf:n}}()},{}],54:[function(e,t,n){!function(){"use strict";var e={STRING:"string",DATE:"date",INT:"int",BOOLEAN:"boolean",ENUM:"enum",UUID:"uuid",LIST:"list",UNKNOWN:"unknown"};t.exports={currentVersion:"0",type:e,token:{currentVersion:"0",versions:{0:[{key:"token.access_token",type:e.STRING},{key:"token.swid",type:e.UUID},{key:"token.refresh_token",type:e.STRING},{key:"token.ttl",type:e.INT},{key:"token.refreshTtl",type:e.INT},{key:"token.sso",type:e.UUID},{key:"token.created",type:e.STRING},{key:"token.lastChecked",type:e.STRING},{key:"token.expires",type:e.STRING},{key:"token.refresh_expires",type:e.STRING},{key:"token.authenticator",type:e.STRING},{key:"token.blue_cookie",type:e.STRING}],1:[{key:"token.access_token",type:e.STRING},{key:"token.swid",type:e.STRING},{key:"token.refresh_token",type:e.STRING},{key:"token.ttl",type:e.INT},{key:"token.refreshTtl",type:e.INT},{key:"token.sso",type:e.UUID},{key:"token.created",type:e.STRING},{key:"token.lastChecked",type:e.STRING},{key:"token.expires",type:e.STRING},{key:"token.refresh_expires",type:e.STRING},{key:"token.authenticator",type:e.STRING},{key:"token.blue_cookie",type:e.STRING}]}}}}()},{}],55:[function(e,t,n){!function(){"use strict";function n(){return r}function o(e){i=e,r=new a(c.CLIENT),r.frames=c,r.registerChild(r.frames.LIGHTBOX,i.getOrigin()),r.registerChild(r.frames.RESPONDER,"*"),r.registerChild(r.frames.MIGRATION_RESPONDER,"*"),s.subscribe("responder.session.write",function(e,t){r.send(r.frames.RESPONDER,"responder.session.write",e,t)}),s.subscribe("responder.session.read",function(e,t){r.send(r.frames.RESPONDER,"responder.session.read",e,t)}),s.subscribe("responder.session.delete",function(e,t){r.send(r.frames.RESPONDER,"responder.session.delete",null,t)}),s.subscribe("responder.guest.identifier.write",function(e,t){r.send(r.frames.RESPONDER,"responder.guest.identifier.write",e,t)}),s.subscribe("responder.guest.identifier.read",function(e,t){r.send(r.frames.RESPONDER,"responder.guest.identifier.read",e,t)}),s.subscribe("responder.dateOfBirth.write",function(e,t){r.send(r.frames.RESPONDER,"responder.dateOfBirth.write",e,t)}),s.subscribe("responder.dateOfBirth.read",function(e,t){r.send(r.frames.RESPONDER,"responder.dateOfBirth.read",null,t)}),s.subscribe("responder.authenticator.write",function(e,t){r.send(r.frames.RESPONDER,"responder.authenticator.write",e,t)}),s.subscribe("responder.authenticator.read",function(e,t){r.send(r.frames.RESPONDER,"responder.authenticator.read",null,t)}),s.subscribe("siteconfig.read",function(e,t){r.send(r.frames.LIGHTBOX,"siteconfig.read",null,t)}),s.subscribe("bluecookie.authenticate",function(e,t){r.send(r.frames.LIGHTBOX,"bluecookie.authenticate",e,t)}),s.subscribe("obo.authenticate",function(e,t){r.send(r.frames.LIGHTBOX,"obo.authenticate",e,t)}),s.subscribe("bluecookie.delete",function(e,t){r.send(r.frames.LIGHTBOX,"bluecookie.delete",null,t)}),s.subscribe("lightbox.show",function(){r.send(r.frames.LIGHTBOX,"lightbox.show",void 0)}),s.subscribe("session.deleted",function(){r.send(r.frames.LIGHTBOX,"session.deleted")}),s.subscribe("inner.setRoute",function(e,t){r.send(r.frames.LIGHTBOX,"inner.setRoute",e,t)}),s.subscribe("guest.tokenrefresh",function(e,t){r.send(r.frames.LIGHTBOX,"guest.tokenrefresh",e,t)}),s.subscribe("guest.reload",function(e,t){r.send(r.frames.LIGHTBOX,"guest.reload",e,t)}),s.subscribe("guest.trustStateChanged",function(e,t){r.send(r.frames.LIGHTBOX,"guest.trustStateChanged",e,t)}),s.subscribe("cagoots.check",function(e,t){r.send(r.frames.LIGHTBOX,"cagoots.check",e,t)}),s.subscribe("newsletters.check-list",function(e,t){r.send(r.frames.LIGHTBOX,"newsletters.check-list",e,t)}),s.subscribe("debug.geoIP",function(e){r.send(r.frames.LIGHTBOX,"debug.geoIP",e)}),s.subscribe("debug.country",function(e){r.send(r.frames.LIGHTBOX,"debug.country",e)}),s.subscribe("debug.clear",function(){r.send(r.frames.LIGHTBOX,"debug.clear")}),s.subscribe("readyToClose",function(){r.send(r.frames.LIGHTBOX,"readyToClose")}),s.subscribe("logger.enable",function(){r.send(r.frames.LIGHTBOX,"logger.enable")}),s.subscribe("debug.clientConfigOverride",function(e){r.send(r.frames.LIGHTBOX,"debug.clientConfigOverride",e)}),s.subscribe("authReloader.reloadIfChanged",function(e,t){r.send(r.frames.LIGHTBOX,"authReloader.reloadIfChanged",e,t)}),s.subscribe("setLogLevel",function(e){r.send(r.frames.LIGHTBOX,"setLogLevel",e)}),s.subscribe("validateDOB",function(e,t){r.send(r.frames.LIGHTBOX,"validateDOB",e,t)}),s.subscribe("workflow.run",function(e,t){r.send(r.frames.LIGHTBOX,"workflow.run",e,t)}),s.subscribe("workflow.execute",function(e,t){r.send(r.frames.LIGHTBOX,"workflow.execute",e,t)}),r.on("metrics.log.send",function(e){s.publish("metrics.log.send",e)}),r.on("cookielength",function(e){s.publish("cookielength",e)}),r.on("session.isloggedin",function(e,t){s.publish("session.isloggedin",null,t)}),r.on("session.reauth",function(e,t){s.publish("session.reauth",null,t)}),r.on("apiEvent.reauth",function(e,t){s.publish("apiEvent.reauth",null,t)}),r.on("lightbox.hide",function(){s.publish("lightbox.hide")}),r.on("license-plate-redeemed",function(){s.publish("license-plate-redeemed")}),r.on("s2cookie.write",function(e,t){s.publish("s2cookie.write",e,t)}),r.on("guest.write",function(e,t){s.publish("guest.write",e,t)}),r.on("guest.read",function(e,t){s.publish("guest.read",e,t)}),r.on("token.write",function(e,t){s.publish("token.write",e,t)}),r.on("token.read",function(e,t){s.publish("token.read",e,t)}),r.on("session.found",function(e){s.publish("session.found",e)}),r.on("session.notfound",function(e){s.publish("session.notfound",e)}),r.on("migration.session.found",function(e){s.publish("migration.session.found",e)}),r.on("migration.session.notfound",function(e){s.publish("migration.session.notfound",e)}),r.on("session.delete",function(e,t){s.publish("session.delete",e,t)}),r.on("session.dateOfBirth.write",function(e,t){s.publish("session.dateOfBirth.write",e,t)}),r.on("session.dateOfBirth.read",function(e,t){s.publish("session.dateOfBirth.read",null,t)}),r.on("session.authenticator.read",function(e,t){s.publish("session.authenticator.read",null,t)}),r.on("profile.create",function(e){s.publish("profile.create",e)}),r.on("profile.primary-account",function(e){s.publish("profile.primary-account",e)}),r.on("session.refreshed",function(e){s.publish("session.refreshed",e)}),r.on("token.refreshed",function(e){s.publish("token.refreshed",e)}),r.on("trustState.write",function(e,t){s.publish("trustState.write",null,t)}),r.on("trustState.read",function(e,t){s.publish("trustState.read",null,t)}),r.on("trustState.readHighestEspnTs",function(e,t){s.publish("trustState.readHighestEspnTs",null,t)}),r.on("trustState.delete",function(e,t){s.publish("trustState.delete",null,t)}),r.on("trustState.get",function(e,t){s.publish("trustState.get",null,t)}),r.on("config.ready",function(e){s.publish("config.ready",e)}),r.on("lightbox.requestshow",function(e){s.publish("lightbox.show",e)}),r.on("lightbox.heartbeat",function(){s.publish("lightbox.heartbeat")}),r.on("lightbox.showError",function(e,t){s.publish("lightbox.showError",e,t)}),r.on("marketing.opt-in",function(e){s.publish("marketing.opt-in",e)}),r.on("metrics.actions.start",function(e){s.publish("metrics.actions.start",e)}),r.on("swid.read",function(e,t){s.publish("swid.read",e,t)}),r.on("navy.read",function(e,t){s.publish("navy.read",e,t)}),r.on("inner.fatal",function(){s.publish("inner.fatal")}),r.on("session.loggedin",function(e,t){s.publish("session.loggedin",e,t)}),r.on("session.authenticator.write",function(e,t){s.publish("session.authenticator.write",e,t)}),r.on("guest.updated",function(e){s.publish("guest.updated",e)}),r.on("doNotDisturb.isEnabled",function(e,t){s.publish("doNotDisturb.isEnabled",null,t)}),r.on("env.correlation.read",function(e,t){s.publish("env.correlation.read",e,t)}),r.on("apiEvent.ppu",function(e,t){s.publish("apiEvent.ppu",t,t)}),r.on("profile.deactivation-complete",function(e,t){s.publish("profile.deactivation-complete",e,t)}),r.init()}t.exports={init:o,getPMT:n};var r,i,s=e("../../common/messages/index").getInstance(),a=e("../../common/postmessage-transport"),c=e("../../common/postmessage-transport/frames")}()},{"../../common/messages/index":13,"../../common/postmessage-transport":17,"../../common/postmessage-transport/frames":16}],56:[function(e,t,n){!function(){"use strict";function n(){var e=r.defer();return r.spread([i.getGuest(),o.getSite()],function(t,n){var o=s.getEditableAndRequiredFields(t,n);e.resolve(o)},function(t){e.reject(t)}),e.promise}var o=e("../../../components/outer/config"),r=e("q"),i=e("../../../components/outer/session/session"),s=e("../../../components/common/progressive-profile-collection");t.exports={get:n}}()},{"../../../components/common/progressive-profile-collection":20,"../../../components/outer/config":47,"../../../components/outer/session/session":63,q:1}],57:[function(e,t,n){!function(){"use strict";function t(e){function t(){d.debug("In doTokenRefresh()"),c.aquire(function(){o().then(function(t){if(l.get(t,"token.access_token")!==l.get(e,"token.access_token"))return d.debug("Token has been refreshed by another tab/window"),d.debug("Calling success, and firing a token.refreshed event"),f.publish("token.refreshed",{token:t.token,previousToken:e.token}),i(t),c.release();if(!l.get(t,"token.refresh_token")&&!l.get(t,"token.blue_cookie "))return d.debug("We have an invalid access token and refresh token, logging guest out"),y.error(y.actions.event.refresh,{anon:!1,swid:l.get(e,"token.swid"),correlation_id:p.getCorrelationId(),error_category:"FAILURE_BY_DESIGN",error_codes:"AUTHORIZATION_MISSING_REFRESH_TOKEN"}),f.publish("session.delete","invalidaccessandrefreshtoken"),c.release();var n=h.defer();r(t,n),n.promise.then(function(e){i(e),c.release()}).fail(function(t){var n=new b(l.get(e,"token")),o=(l.get(t,"error.errors")||[]).some(function(e){return"AUTHORIZATION_INVALID_REFRESH_TOKEN"===(e||{}).code});d.debug("Token refresh failed, checking response for errors"),d.debug("Do Not Disturb Enabled?: "+!!v.getState()),d.debug("Access Token Expired?: "+n.isExpired()),d.debug("Have Invalid Refresh Token?: "+o),!v.getState()&&o?(d.debug("We have an invalid access token and refresh token, logging guest out"),f.publish("session.delete","invalidaccessandrefreshtoken")):s(e,a.state),c.release()})},function(){c.release(),v.getState()||(d.debug("Guest was logged out in another tab"),f.publish("session.delete","loggedoutinothertab"))})})}d.log("RefreshTimer#startTimer"),e=l.clone(e);var a,g=new b(e.token);return n(),a=g.getNextRefreshAttempt(new Date,m),d.debug("Next token refresh should occur at:"),d.debug(a),function(){var e=function(){new Date>(a.date||new Date)?t():u=setTimeout(e,1e4)};e()}(),a}function n(){c||(c=new g(p.getClientId()))}function o(){var e=h.defer();return f.publish("token.read",null,e),e.promise}function r(e,t){return d.debug("attempting token refresh"),f.publish("guest.tokenrefresh",e.token,t),t.promise}function i(){d.log("RefreshTimer#handleRefreshSuccess"),m.reset()}function s(e,n){d.log("RefreshTimer#handleRefreshFailure"),m.increment(n),t(e)}function a(){clearTimeout(u)}var c,u,l=e("utils"),d=e("logger"),f=e("../../common/messages").getInstance(),p=e("../environment"),g=e("../../common/mutex"),h=e("../../../../assets/common/js/q"),m=e("../../common/retry-counter"),v=e("../ui/do-not-disturb"),b=e("../token/"),y=e("metrics");f.subscribe("token.refreshed",t),f.subscribe("session.loggedin",t),f.subscribe("session.reestablished",t),f.subscribe("session.delete",a)}()},{"../../../../assets/common/js/q":1,"../../common/messages":13,"../../common/mutex":14,"../../common/retry-counter":22,"../environment":48,"../token/":65,"../ui/do-not-disturb":68,logger:12,metrics:38,utils:30}],58:[function(e,t,n){!function(){"use strict";function n(){o(),a=[],a.push(u.subscribe("s2cookie.write",r)),a.push(u.subscribe("s2cookie.delete",i))}function o(){(a||[]).forEach(function(e){e()})}function r(e,t){s().then(function(n){var o=new Date;o.setFullYear(o.getFullYear()+33),p.write(n.name,e,n.domain,"/",o),p.read(n.name)!==e&&g&&p.write(n.name,e,"."+g,"/",o),(t||d.defer()).resolve(),f.debug('Writing S2 Cookie "'+n.name+'" to "'+n.domain+'"')})}function i(e){s().then(function(t){p.remove(t.name,t.domain,"/"),g&&p.remove(t.name,"."+g,"/"),p.remove(t.name,window.location.hostname,"/"),(e||d.defer()).resolve()})}function s(){var e=d.defer();return l.getSite().then(function(t){var n=c.get(t,"clientInfo.s2-namespace"),o=c.get(t,"clientInfo.s2-domain");e.resolve({name:n?n+"_s2":"s2",domain:o?o:window.location.hostname})}),e.promise}t.exports={init:n};var a,c=e("utils"),u=e("messages").getInstance(),l=e("../config"),d=e("../../../../assets/common/js/q"),f=e("logger"),p=e("cookie"),g=c.getTLD(window.location.hostname)}()},{"../../../../assets/common/js/q":1,"../config":47,cookie:6,logger:12,messages:13,utils:30}],59:[function(e,t,n){!function(){"use strict";function n(e,t){var n=c.clone(e),o=JSON.stringify(n),r=c.crc32(JSON.stringify({guest:e.guest})).toString(16);return{data:a.encrypt(r+t,o),checksum:u+r}}function o(e,t,n){var o;try{o=JSON.parse(a.decrypt(e.substring(2)+t,n))}catch(r){return null}return o}function r(e,t,o){var r={guest:e.guest,created:(new Date).toISOString()},i=n(r,t);try{localStorage.setItem(o+".guest",i.data)}catch(s){}return i.checksum}function i(e,t,n){var r;try{r=localStorage.getItem(n+".guest")}catch(i){}return o(""+e,t,r)}function s(e){try{localStorage.removeItem(e+".guest")}catch(t){}}var a=e("../../../../../../assets/common/js/sjcl"),c=e("utils"),u="00";t.exports={write:r,read:i,remove:s}}()},{"../../../../../../assets/common/js/sjcl":2,utils:30}],60:[function(e,t,n){!function(){"use strict";function n(){m.push(l.subscribe("guest.write",r)),m.push(l.subscribe("guest.read",i)),m.push(l.subscribe("session.delete",s)),m.push(l.subscribe("token.refreshed",a))}function o(){m.forEach(function(e){e()}),m=[]}function r(e,t){function n(e,n,o){var r=d.defer(),i=c.write(e,n.access_token,o);l.publish("guest.identifier.write",i,r),p.write(u.get(e,"guest")),r.promise["finally"](function(){t.resolve()})}var o=f.getClientId();if(!u.get(e,"guest"))return t.resolve();if(!e.token||!e.token.access_token){var r=d.defer();return l.publish("token.read",null,r),void r.promise.then(function(t){n(e,t.token,o)},function(){t.reject()})}n(e,e.token,o)}function i(e,t){function n(t,n,f){f="undefined"==typeof f?216e5:f;var p,g;if(!u.get(n,"access_token"))return r();i=c.read(t,n.access_token,m);try{p=Date.parse(i.created)}catch(v){}return(isNaN(p)||!isFinite(p))&&(p=Date.now()),g=p+f<=Date.now(),!i||g?(h||(h=d.defer(),s=Date.now(),a=!0,l.publish("guest.reload",n,h)),void h.promise.then(function(t){var r;i={guest:t.data,token:n},u.get(i,"guest.token")&&delete i.guest.token,r=c.write(i,n.access_token,m),l.publish("guest.identifier.write",r),!e.forced&&e.context&&a&&y.success(),o()},r)):void o()}function o(){t.resolve(i),h=null}function r(n){if(!e.forced&&e.context&&a){var o=u.get(n,"error"),r=u.get(p,"token")||{};if(o){var i=u.get(o,"errors")||[],s=i.map(function(e){return e.code});g.log("log:getguest",{error_category:u.get(o,"keyCategory"),error_codes:s.join(","),info:{session:""+e.sessionState,token:""+u.maskToken(r.access_token),ttl:Date.parse(r.expires)-Date.now()}})}}t.reject(n),h=null}var i,s,a,p,m=f.getClientId(),v=d.defer(),b=d.defer(),y=g.timed("log:getguest");return e=e||{},e.token&&e.identifier?(p=e,void n(e.identifier,e.token,e.cacheTtl)):(l.publish("guest.identifier.read",null,v),l.publish("token.read",null,b),void d.spread([v.promise,b.promise],function(t,o){p=o,n(t,(p||{}).token,e.cacheTtl)},r))}function s(){c.remove(f.getClientId()),p.remove()}function a(e){var t,n=f.getClientId(),o=d.defer();l.publish("guest.identifier.read",null,o),o.promise.then(function(o){t=c.read(""+o,e.previousToken.access_token,n),t&&(o=c.write({guest:t.guest,token:e.token},e.token.access_token,n),l.publish("guest.identifier.write",o))})}t.exports={init:n,reset:o};var c=e("./index"),u=e("utils"),l=e("messages").getInstance(),d=e("../../../../../../assets/common/js/q"),f=e("../../../environment"),p=e("../../../ageband-country-cookie"),g=e("metrics"),h=null,m=[]}()},{"../../../../../../assets/common/js/q":1,"../../../ageband-country-cookie":43,"../../../environment":48,"./index":59,messages:13,metrics:38,utils:30}],61:[function(e,t,n){!function(){"use strict";function n(){}function o(e){var t=document.createElement("iframe");t.setAttribute("id","disneyid-secure-responder"),t.setAttribute("name","disneyid-secure-responder"),t.setAttribute("src",e),t.style.display="none",document.body.appendChild(t)}var r=e("../../common/messages").getInstance(),i=e("../../common/event-emitter"),s=e("../../../../assets/common/js/q");t.exports=i.emittable(n),n.prototype.init=function(e){var t=this;return this.watchSessionMismatches=!0,r.subscribe("session.found",function(e){t.emit("session.found",e)}),r.subscribe("session.notfound",function(e){t.emit("session.notfound",e)}),document.body?void o(e.responderPage):void document.addEventListener("DOMContentLoaded",function(){o(e.responderPage)})},n.prototype.writeSessionData=function(e,t){r.publish("responder.session.write",e,t)},n.prototype.readSessionData=function(e,t){return t=t||s.defer(),r.publish("responder.session.read",e,t),t.promise},n.prototype.deleteSessionData=function(){var e=s.defer();return r.publish("responder.session.delete",null,e),e.promise},n.prototype.writeIdentifier=function(e,t){return t=t||s.defer(),r.publish("responder.guest.identifier.write",e,t),t.promise},n.prototype.readIdentifier=function(e){return e=e||s.defer(),r.publish("responder.guest.identifier.read",null,e),e.promise},n.prototype.writeDateOfBirth=function(e,t){return t=t||s.defer(),r.publish("responder.dateOfBirth.write",e,t),t.promise},n.prototype.readDateOfBirth=function(e,t){return t=t||s.defer(),r.publish("responder.dateOfBirth.read",e,t),t.promise},n.prototype.writeAuthenticator=function(e,t){return t=t||s.defer(),r.publish("responder.authenticator.write",e,t),t.promise},n.prototype.readAuthenticator=function(e,t){return t=t||s.defer(),r.publish("responder.authenticator.read",e,t),t.promise}}()},{"../../../../assets/common/js/q":1,"../../common/event-emitter":10,"../../common/messages":13}],62:[function(e,t,n){!function(){"use strict";function n(){}function o(e){w.log("Adapter#writeNavyCookie");var t=h.get(e,"token.blue_cookie"),n=new Date;h.isEspnClientId(g)&&t&&(n.setFullYear(n.getFullYear()+1),_.write("oidNAVY",t,"."+N,"/",n,!1))}function r(){w.log("Adapter#getSessionData");var e=_.read(a);if(null===e)return null;var t=m.decodeToken(e);return t?t.token:null}function i(){w.log("Adapter#getOboTokenData");var e=h.getCookie(c);return null===e?null:e}function s(){w.log("Adapter#getSwidFromCookie");var e=h.getCookie(u);return null===e?null:e}var a,c,u,l,d,f,p,g,h=e("../../common/utils"),m=e("../guest-encoding"),v=e("../../common/event-emitter"),b=e("../../../../assets/common/js/q"),y=e("../ageband-gating"),I=e("../../common/environment-helper"),E=(e("messages").getInstance(),e("metrics")),w=e("logger"),_=e("cookie"),S=e("../../common/trust-state/constants.js"),N=h.getTLD(""+window.location.hostname);t.exports=v.emittable(n),n.prototype.init=function(e){w.log("Adapter#init");var t=this;g=e.clientId,a=e.clientId+".token",c="obo",u="swid",l=e.cookieDomain,d=e.clientId+".idn",f=e.clientId+y.AGEBAND_DATA_SUFFIX,p=e.clientId+".auth",t.watchSessionMismatches=!0;var n=r(),o=i(),m=s();o&&m?n?t.emit("session.found",{obotoken:o}):(t.emit("session.notfound",{obotoken:o,swid:m}),h.getCookieDomains().forEach(function(e){w.debug("deleting obo/swid cookies from: "+e),_.remove(c,e,"/"),_.remove(u,e,"/")})):n?t.emit("session.found",{token:n}):t.emit("session.notfound",{navy:_.read("oidNAVY")})},n.prototype.readSessionData=function(e,t){w.log("Adapter#readSessionData");var n=r();return t=t||b.defer(),null!==n?t.resolve({token:n}):t.reject(),t.promise},n.prototype.writeSessionData=function(e,t){w.log("Adapter#writeSessionData");var n;if(t=t||b.defer(),n=new Date,n.setFullYear(n.getFullYear()+33),o(e),"object"==typeof e.token){var r,i,s;e.token.blue_cookie=null,s=m.encodeToken({token:e.token}),r=_.read(a)||"",_.write(a,s,l,"/",n,!0);try{i=_.read(a)||"",i!==s&&E.error("log:cookie:write",{swid:e.token.swid,info:{o_eq_a:""+(r==i),o_eq_n:""+(r==s),o_size:""+r.length,n_size:""+s.length,a_size:""+i.length,cookieLength:""+document.cookie.length}})}catch(c){}}return t.resolve(e.token),t.promise},n.prototype.deleteSessionData=function(){w.log("Adapter#deleteSessionData");var e=b.defer(),t=I.getClientIdSuffix(g);if(h.getCookieDomains().forEach(function(e){w.debug("deleting token/auth/idn cookies from: "+e),_.remove(a,e,"/"),_.remove(p,e,"/"),_.remove(d,e,"/")}),_.remove("oidNAVY","."+N,"/"),h.isEspnClientId(g)){var n=[l,".go.com",".espn.go.com","."+N];h.getEspnWhitelist().forEach(function(e){var o=e+"-"+t;n.forEach(function(e){_.remove(o+".token",e,"/"),_.remove(o+".auth",e,"/"),_.remove(o+".idn",e,"/")})})}return e.resolve(),e.promise},n.prototype.writeIdentifier=function(e,t){return w.log("Adapter#writeIdentifier"),t=t||b.defer(),_.write(d,e,l,"/",0,!0),t.resolve(),t.promise},n.prototype.readIdentifier=function(e){return w.log("Adapter#readIdentifier"),e=e||b.defer(),e.resolve(_.read(d)),e.promise},n.prototype.writeDateOfBirth=function(e,t){w.log("Adapter#writeDateOfBirth");var n;return n=new Date(Date.now()+y.AGEBAND_TIMEOUT),t=t||b.defer(),_.write(f,n.toISOString(),l,"/",n,!1),t.resolve(),t.promise},n.prototype.readDateOfBirth=function(e,t){w.log("Adapter#readDateOfBirth");var n=_.read(f);return t=t||b.defer(),n?t.resolve(n):t.reject(n),t.promise},n.prototype.writeAuthenticator=function(e,t){w.log("Adapter#writeAuthenticator");var n;return n=new Date,n.setFullYear(n.getFullYear()+33),t=t||b.defer(),e.token&&_.write(p,e.token.authenticator,l,"/",n,!1),t.resolve(),t.promise},n.prototype.readAuthenticator=function(e,t){w.log("Adapter#readAuthenticator"),t=t||b.defer();var n=_.read(p);if(h.isEspnClientId(g)){var o=I.getClientIdSuffix(g);h.getEspnWhitelist().some(function(e){var t=_.read(e+"-"+o+".auth");return-1!==S.IGNORED_REAUTH_AUTHENTICATORS.indexOf(t)?(n=t,!0):void 0})}return t.resolve(n),t.promise}}()},{"../../../../assets/common/js/q":1,"../../common/environment-helper":8,"../../common/event-emitter":10,"../../common/trust-state/constants.js":24,"../../common/utils":30,"../ageband-gating":44,"../guest-encoding":52,cookie:6,logger:12,messages:13,metrics:38}],63:[function(e,t,n){!function(){"use strict";function n(e,t){F.log("Session#init"),D=e,A=t,k=V.NOT_KNOWN,O=x.defer(),R=e.getMigrationResponderPageUrl(),C=e.getCookieDomain(),T=new U(e.getClientId()),A.on("session.found",p),A.on("session.notfound",g),P.subscribe("guest.identifier.write",s),P.subscribe("guest.identifier.read",a),P.subscribe("session.dateOfBirth.write",c),P.subscribe("session.dateOfBirth.read",u),P.subscribe("session.authenticator.read",l),P.subscribe("session.authenticator.write",d),P.subscribe("token.write",h),P.subscribe("token.read",v),P.subscribe("navy.read",b),P.subscribe("session.delete",y),P.subscribe("session.isloggedin",I),P.subscribe("session.updatelastchecked",_),
A.init({cookieDomain:e.getCookieDomain(),clientId:e.getClientId(),responderPage:e.getResponderPageUrl()})}function o(){return k}function r(e,t){var n=x.defer();return t=t||{},i().then(function(o){var r=x.defer(),i={identifier:H.read(D.getClientId()+".idn"),token:o.token,context:t.context,forced:e,sessionState:k};e&&(i.cacheTtl=0),P.publish("guest.read",i,r),r.promise.then(function(e){e.guest.token=o.token,n.resolve(e.guest)},function(e){var t=G.get(e,"error");n.reject(t)})},function(){n.reject()}),n.promise}function i(){var e=x.defer();return w().then(function(t){t?A.readSessionData().then(function(t){e.resolve(t)},function(){e.reject("Session not established")}):e.reject("Session not established")}),e.promise}function s(e,t){A.writeIdentifier(e,t)}function a(e,t){A.readIdentifier(t)}function c(e,t){A.writeDateOfBirth(e,t)}function u(e,t){A.readDateOfBirth(e,t)}function l(e,t){A.readAuthenticator(e,t)}function d(e,t){A.writeAuthenticator(e,t)}function f(e){F.log("Session#refreshToken");var t=x.defer(),n=x.defer();return T.aquire(function(){P.publish("guest.tokenrefresh",e,n),n.promise.then(function(e){t.resolve(e)},function(e){t.reject(e)})["finally"](function(){setTimeout(function(){T.release()},0)})}),t.promise}function p(e){function t(e){E(V.LOGGED_IN),P.publish("session.reestablished",{guest:{token:e},token:e}),S()}if(F.log("Session#handleSessionFound"),e.obotoken){var n=x.defer();setTimeout(function(){y("obo",n),n.promise.then(function(){setTimeout(function(){location.reload()},2e3)})},500)}else new j(e.token).isExpired()&&!D.isDirectFlow()?f(e.token).then(function(n){t(n||e.token)},function(n){var o=G.get(n,"data.token"),r=(G.get(n,"error.errors")||[]).some(function(e){return"AUTHORIZATION_INVALID_REFRESH_TOKEN"===(e||{}).code});return r&&!o?void setTimeout(function(){P.publish("session.delete","invalidRefreshToken")},1e3):void t(o||e.token)}):t(e.token)}function g(e){F.log("Session#handleSessionNotFound");var t=x.defer(),n=G.isEspnClientId(D.getClientId()),o=D.blueCookieEnabled(),r=!!H.read("BLUE"),i=!!H.read("oidNAVY");(e||{}).obotoken&&(e||{}).swid?P.publish("obo.authenticate",{obo:e.obotoken,swid:e.swid},t):o&&(r||n&&i)?P.publish("bluecookie.authenticate",{blue:H.read("oidNAVY")||H.read("BLUE")},t):R&&!H.read(W)?(F.debug("OneID session not found on ."+C+"; initializaing ESPN.com migration module"),M.init({responderPage:R,clientId:D.getClientId(),cookieDomain:C,onMigrationSuccess:function(){var e=new Date;e.setFullYear(e.getFullYear()+33),H.write(W,"1",C,"/",e),S(),t.reject()},onMigrationFailure:function(){t.reject()}})):t.reject(),t.promise.then(function(){E(V.LOGGED_IN)},function(){E(V.NOT_LOGGED_IN)})["finally"](function(){S()})}function h(e,t){F.log("Session#handleWriteSessionData");var n=new Date;return e.token||k!==V.NOT_LOGGED_IN?(e.token.created=n.toISOString(),e.token.lastChecked=e.token.created,e.token.expires=G.expires(n,e.token.ttl).toISOString(),void m(e).then(function(e){t.resolve(e)},function(e){t.reject(e)})):void t.resolve()}function m(e){F.log("Session#writeTokenCookie");var t=k,n=x.defer(),o=x.defer();return"object"==typeof e.guest&&(e.guest.token=e.token),A.writeSessionData(e,n),n.promise.then(function(){E(V.LOGGED_IN),t===V.NOT_KNOWN?(P.publish("session.reestablished",e),o.resolve()):o.resolve()}),o.promise}function v(e,t){F.log("Session#handleReadSessionData"),i().then(function(e){t.resolve(e)}).fail(function(){t.reject()})}function b(e,t){F.log("Session#handleReadNavy"),t.resolve({value:H.read("oidNAVY")})}function y(e,t){F.log("Session#handleDelete");var n=x.defer(),o=x.defer(),r=x.defer(),i=A.deleteSessionData();P.publish("bluecookie.delete",null,n),P.publish("s2cookie.delete",o),P.publish("trustState.delete",null,r),x.all([n.promise,o.promise,r.promise,i])["finally"](function(){E(V.NOT_LOGGED_IN),P.publish("session.deleted",e),null!==t&&"object"==typeof t&&"function"==typeof t.resolve&&t.resolve()})}function I(e,t){w().then(function(e){t.resolve(e)}).fail(function(){t.reject()})}function E(e){k=e,e===V.LOGGED_IN?O.resolve(!0):e===V.NOT_LOGGED_IN&&O.resolve(!1)}function w(){var e=x.defer();return k===V.NOT_KNOWN?O.promise:(e.resolve(k===V.LOGGED_IN),e.promise)}function _(e,t){F.log("Session#handleUpdateLastChecked");var n;return i().then(function(e){n=G.clone(e).token,n.lastChecked=(new Date).toISOString(),m({token:n}).then(function(e){t.resolve(e)},function(e){t.reject(e)})}),t.promise}function S(){function e(){A.watchSessionMismatches!==!0||n>q||(clearTimeout(L),N({notifyLoginSuccess:!0}).then(function(){t(),n=0},function(){t(),n++}))}function t(){L=setTimeout(e,2e3)}var n=0;e()}function N(e){function t(t,s){t===!0&&s===!1?(F.debug("logged out from another window"),P.publish("session.delete","tokendatadeleted"),E(V.NOT_LOGGED_IN),i.resolve()):t===!1&&s===!0?(F.debug("logged in from another window"),E(V.LOGGED_IN),r().then(function(t){var r,s=x.defer();r={ageBand:G.get(t,"profile.ageBand"),legalCountry:G.get(t,"profile.countryCodeDetected")},P.publish("authReloader.reloadIfChanged",r,s),s.promise.then(function(){M.isMigratingSession()&&n(),e.notifyLoginSuccess&&P.publish("session.loggedin",t),i.resolve()},function(e){M.isMigratingSession()&&o(e),i.reject()})},function(e){M.isMigratingSession()&&o(e),i.reject()})):i.resolve()}function n(){B.log(B.actions.event.migration,{client_id:D.getClientId(),swid:M.getSwid(),anon:!1})}function o(e){var t={client_id:D.getClientId(),swid:M.getSwid(),appid:"DTSS-DISNEYID-UI",error_codes:G.get(e.errors[0].code)};(e||{}).reason&&(t.info={reason:e.reason}),B.error(B.actions.event.migration,t)}var i=x.defer();return e=e||{},w().then(function(e){A.readSessionData().then(function(){t(e,!0)},function(){t(e,!1)})}),i.promise}t.exports={init:n,getToken:i,getGuest:r,getState:o,isLoggedIn:w,sync:N,refreshToken:f};var T,O,k,A,D,L,R,C,x=e("../../../../assets/common/js/q"),j=e("../token"),P=e("../../common/messages").getInstance(),B=e("metrics"),U=e("../../common/mutex"),G=e("utils"),F=e("logger"),M=e("../espn/migration"),H=e("cookie"),V={NOT_KNOWN:"not_known",LOGGED_IN:"logged_in",NOT_LOGGED_IN:"not_logged_in"},q=5,W="s_oidSessionMigrated"}()},{"../../../../assets/common/js/q":1,"../../common/messages":13,"../../common/mutex":14,"../espn/migration":49,"../token":65,cookie:6,logger:12,metrics:38,utils:30}],64:[function(e,t,n){!function(){"use strict";function n(e){e=e||{};var t=u.read(l);(!t||d.test(t)&&!e.dontAnonymizeRealSwid||e.force)&&r(a.uuid())}function o(e){return d.test(e)||(e="{"+e+"}"),e}function r(e,t){var n=new Date;n.setFullYear(n.getFullYear()+1),t===!0&&(e=o(e)),u.write(l,e,g,"/",n)}function i(){return o(u.read(l))}function s(e){g=e}var a=e("utils"),c=e("messages").getInstance(),u=e("cookie"),l="SWID",d=/^\{[^}]+\}$/,f=-1,p=a.getTLD(window.location.hostname),g=p?"."+p:".go.com";!function(){c.subscribe("cookielength",function(e){f=e}),c.subscribe("swid.read",function(){var e=arguments[1];e&&e.resolve&&e.resolve({swid:u.read(l),cookieLength:f})})}(),t.exports={anonymize:n,write:r,read:i,setDomain:s}}()},{cookie:6,messages:13,utils:30}],65:[function(e,t,n){!function(){"use strict";function n(e){function t(e,t){s.log("Token#getNextRefreshAttempt");var n=new Date(c.data.created),a=new Date(c.data.expires);if(!i.isValidDate(n)||!i.isValidDate(a))return void s.error("Invalid created or expires date in token object");var m,v,b=new r(n,a),y=b.getPercentElapsed(e),I=b.getSecondsRemaining(e),E=new r(e,b.end);if(y>1){var w=t.getCount(o.EXPIRED),_=new r(b.end,e);v=o.EXPIRED,s.debug("Token currently expired. Retries already attempted within this interval: "+w),g>w?(s.debug("token should be refreshed immedietly"),m=e):(s.debug("Too many attempts made within this interval. Get time nearest to interval of "+h+" (round up)"),t.reset(),m=_.getDateNearestToMultipleOfSeconds(h))}else if(y>=l&&1>y||d>=I&&c.data.ttl>=p)v=o.REFRESH_WINDOW,0===t.getCount(o.REFRESH_WINDOW)?(s.debug("Token is active, we are within the token refresh window and a refresh attempt has not yet been made. Refresh immedietly."),m=e):(s.debug("Token is active, we are within the token refresh window, and an attempt has already been made."),m=E.getDateAtPercent(f));else{s.debug("Valid token"),v=o.VALID;var S=b.getDateAtPercent(l).getTime(),N=c.data.ttl<=p?S:b.end.getTime()-d*u;m=new Date(Math.min(S,N))}return{date:m,state:v}}function n(){var e=new Date(c.data.expires),t=e.getTime();return!c.isValid()||isNaN(t)||t<(new Date).getTime()}function a(){return"string"==typeof c.data.access_token&&"string"==typeof c.data.swid&&"number"==typeof c.data.ttl}var c=this;this.data=e||{},this.getNextRefreshAttempt=t,this.isValid=a,this.isExpired=n;var u=1e3,l=.9,d=300,f=.5,p=480,g=3,h=300}t.exports=n;var o={VALID:1,REFRESH_WINDOW:2,EXPIRED:3},r=e("../../common/time-span"),i=e("utils"),s=e("logger");n.TOKEN_LIFECYCLE_STATE=o}()},{"../../common/time-span":23,logger:12,utils:30}],66:[function(e,t,n){!function(){"use strict";function n(){l.subscribe("session.loggedin",o),l.subscribe("session.reauth",o),l.subscribe("session.deleted",function(){a=void 0,r()}),l.subscribe("trustState.get",function(e,t){i().then(function(e){t.resolve(e)})})}function o(){f.log("TrustState#watch");var e=(u.defer(),u.defer());i().then(function(t){if(l.publish("guest.trustStateChanged",t.state,t.timeLeft),r(),t.state===d.STATES.low)return void l.publish("trustState.delete",null,e);l.publish("trustState.setTimer",t.timeLeft);var n=l.subscribe("trustState.timerExpired",function(){l.publish("guest.trustStateChanged",d.STATES.low),l.publish("trustState.delete"),n()})},function(){l.publish("guest.trustStateChanged",d.STATES.low),r()})}function r(){l.publish("trustState.clearTimer")}function i(){var e=u.defer(),t=u.defer();return l.publish("trustState.read",null,t),t.promise.then(function(t){var n=Date.parse(t)-(new Date).getTime();e.resolve({state:1>n?d.STATES.low:d.STATES.high,timeLeft:n})},function(){e.resolve({state:d.STATES.low,timeLeft:-1})}),e.promise}function s(){return d.TRUST_EXPIRY}var a,c={init:n,get:i,getTrustLength:s},u=e("../../../../assets/common/js/q"),l=e("messages").getInstance(),d=e("./../../common/trust-state/constants.js"),f=e("logger");t.exports=c}()},{"../../../../assets/common/js/q":1,"./../../common/trust-state/constants.js":24,logger:12,messages:13}],67:[function(e,t,n){!function(){"use strict";function n(){y=m.getCookieDomain(),I=m.getClientId()+".ts",g.subscribe("trustState.setTimer",o),g.subscribe("trustState.clearTimer",r),g.subscribe("trustState.write",i),g.subscribe("trustState.read",s),g.subscribe("trustState.readHighestEspnTs",a),g.subscribe("trustState.delete",u)}function o(e){d=setTimeout(function(){g.publish("trustState.timerExpired")},e)}function r(){clearTimeout(d),d=void 0}function i(e,t){t=t||p.defer();var n=new Date(Date.now()+v.TRUST_EXPIRY),o=b.write(I,n.toISOString(),y,"/",n,!1);o?t.resolve(o):t.reject()}function s(e,t){t=t||p.defer();var n=b.read(I);null===n?t.reject():t.resolve(n)}function a(e,t){t=t||p.defer();var n=c();null===n?t.reject():t.resolve(n)}function c(){var e=h.getEspnWhitelist().map(function(e){return b.read(e+"-"+m.getClientIdEnvSuffix()+".ts")});return e.sort(function(e,t){try{e=new Date(e).getTime()}catch(n){e=0}try{t=new Date(t).getTime()}catch(n){t=0}return e-t}).pop()}function u(e,t){b.remove(I,y,"/"),l(),(t||p.defer()).resolve()}function l(){h.isEspnClientId(m.getClientId())&&h.getEspnWhitelist().forEach(function(e){b.remove(e+"-"+m.getClientIdEnvSuffix()+".ts",y,"/")})}var d,f={init:n},p=e("../../../../assets/common/js/q"),g=e("messages").getInstance(),h=e("utils"),m=e("../environment.js"),v=e("./../../common/trust-state/constants.js"),b=e("cookie"),y="",I="";t.exports=f}()},{"../../../../assets/common/js/q":1,"../environment.js":48,"./../../common/trust-state/constants.js":24,cookie:6,messages:13,utils:30}],68:[function(e,t,n){!function(){"use strict";function n(e){r=e}function o(){return r}t.exports={setState:n,getState:o};var r,i=e("messages").getInstance();i.subscribe("doNotDisturb.isEnabled",function(e,t){t&&t.resolve&&t.resolve(!!o())})}()},{messages:13}],69:[function(e,t,n){var o=e("../../environment");!function(){"use strict";function n(e){"inner.loaded"===e.data&&(E=!0,window.removeEventListener("message",n))}function r(){y.log("UI#appendIframe");var e=document.createElement("style");e.setAttribute("id","disneyid-style"),e.setAttribute("type","text/css"),e.innerHTML="div#disneyid-wrapper{position:absolute;display:none;opacity:0;top:0;left:0;width:100%;height:100%;}div#disneyid-wrapper.state-active {z-index: 9999999;opacity:1;transition:opacity 300ms;-webkit-transition:opacity 300ms;}iframe#disneyid-iframe{width:100%;height:100%;}",p=document.createElement("div"),p.setAttribute("id","disneyid-wrapper"),f=document.createElement("iframe"),f.setAttribute("id","disneyid-iframe"),f.setAttribute("name","disneyid-iframe"),f.setAttribute("frameborder","0");var t=d.getPath();f.setAttribute("src",t),p.appendChild(f),document.head.appendChild(e),document.body.appendChild(p);var n=setTimeout(function(){h.publish("lightbox.showError",{reason:"inner.timeout"})},9e4);h.subscribe("lightbox.heartbeat",function(){clearTimeout(n)})}function i(e){d=e,m.docReady(r)}function s(e,t){e&&e.deferWhenDoNotDisturbEnabled&&v.getState()||m.docReady(function(){b.disable(),a(),setTimeout(function(){p.className="state-active"},0),setTimeout(function(){p.style.display="block",t&&t.resolve&&t.resolve()},50),I&&g.error(g.actions.event.serviceError,{error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",info:{"static":"true"}})})}function a(){y.log("UI#setFrameFocus");var e=Date.now(),t=setInterval(function(){if(document.activeElement!==f&&Date.now()-e<5e3)try{f.focus()}catch(n){}else clearInterval(t)},100)}function c(){y.log("UI#clearFrameFocus");try{document.querySelector("body").focus()}catch(e){}}function u(){y.log("UI#hide"),p&&(p.style.display="none",p.className=""),b.enable(),c()}function l(e){y.log("UI#showError"),I=!0;var t=d.getStandardQueryParams(),n=m.get(e,"reason")||"outer",r=o.getOrigin()+"/v2/error/"+o.getClientId()+"/"+o.getLangPref()+"?reason="+encodeURIComponent(n);t.cssOverride&&(r+="&cssOverride="+encodeURIComponent(t.cssOverride)),f&&(f.src=r),g.error("log:service-error.static",{error_category:"UNKNOWN_ERROR",error_codes:"UNKNOWN_ERROR",info:{reason:n,innerLoaded:""+E}})}t.exports={init:i,show:s,hide:u};var d,f,p,g=e("metrics"),h=e("messages").getInstance(),m=e("utils"),v=e("../do-not-disturb"),b=e("./scroll"),y=e("logger"),I=!1,E=!1;window.addEventListener("message",n,!1),h.subscribe("lightbox.show",s),h.subscribe("lightbox.hide",u),h.subscribe("lightbox.showError",l)}()},{"../../environment":48,"../do-not-disturb":68,"./scroll":70,logger:12,messages:13,metrics:38,utils:30}],70:[function(e,t,n){!function(){"use strict";function e(){i||(r=window.document.querySelector("body"),o={html:{overflow:r.style.overflow,height:r.style.height},body:{overflow:r.style.overflow,height:r.style.height}},s.style.overflow="hidden",s.style.height="100%",r.style.overflow="hidden",r.style.height="100%",i=!0)}function n(){i&&(s.style.overflow=o.html.overflow,s.style.height=o.html.height,r.style.overflow=o.body.overflow,r.style.height=o.body.height,i=!1)}t.exports={enable:n,disable:e};var o,r,i=!1,s=window.document.querySelector("html")}()},{}],71:[function(e,t,n){!function(){"use strict";"etag-bump";function n(e){if(!E){if(!e||!Object.keys(e).length)throw new Error(H.NO_CONFIG_OPTIONS);if(!e.clientId)throw new Error(H.NO_CLIENT_ID);if("string"!=typeof e.responderPage)throw new Error(H.NO_RESPONDER_PAGE);if(e.cookieDomain){if("string"!=typeof e.cookieDomain)throw new Error(H.INVALID_COOKIE_DOMAIN);var t=0===window.location.protocol.toLowerCase().indexOf("https")?window.location.hostname:T.url.getHostName(e.responderPage);if(!o(e.cookieDomain,t))throw new Error(H.INVALID_COOKIE_DOMAIN)}y=T.clone(e),e.correlationId||(e.correlationId=T.uuid()),e.correlationId&&e.correlationIdTimeStamp||(e.correlationIdTimeStamp=(new Date).getTime())}if(e&&E)throw new Error(H.CONFIG_SET);return e&&!E&&(e.logLevel&&U.setLogLevel(e.logLevel),E=new b(e),E.on("error",function(e){U.error(e)})),E}function o(e,t){var n=e.split("."),o=t.split(".");if(n.length<2)return!1;for(;o.length>n.length;)o.shift();return e===o.join(".")}function r(e){I=e||{},e.isDirectFlow&&(b.prototype.launchSocialLoginExceptionHandler=s,b.prototype.launchPPU=a,b.prototype.sync=c,b.prototype.launchReady=u)}function i(){E=void 0}function s(e){e.interactionOpts=p(e),O.publish("bridge.handleSocialLoginException",e)}function a(e){e=e||{},e.interactionOpts=p(e),O.publish("bridge.launchPPU",e)}function c(){return A.sync()}function u(e){if(e=e||{},F.initialized){var t=N.defer();d("ready",e,t)}else E.emit("error",H.NOT_INITIALIZED)}function l(e,t,n,o){var r=N.defer(),i=o?"workflow.execute":"workflow.run";return O.publish(i,{name:e,step:t,data:n},r),r.promise}function d(e,t,n,o){O.publish("inner.setRoute",{name:e,opts:p(t),routeParameters:o},n),T.promise.timeout(n,9e4)}function f(e){var t=T.get(e,"optionalConfigs")||{},n={},o=["sourceName","templateName","siteID","affiliateName"],r=[t,T.get(y,"optionalConfigs")||{},T.get(y,"optionalConfig")||{}];return r.forEach(function(e){o.forEach(function(t){"undefined"==typeof n[t]&&e[t]&&(n[t]=e[t])})}),Object.keys(t).forEach(function(e){-1===o.indexOf(e)&&(n[e]=t[e])}),n}function p(e){return e=e||{},e.correlationId=e.correlationId||T.uuid(),F.conversationId=e.conversationId,e}function g(){A.getToken().then(function(e){O.publish("cagoots.check",e,N.defer())})}function h(e){O.publish("debug.clientConfigOverride",e)}function m(e){return e=e||{},e.conversationId=e.conversationId||T.uuid(),e.correlationId=e.correlationId||T.uuid(),e}function v(e){var t=N.defer(),n=R.timed("log:token_invalid:refresh",{conversation_id:e.conversationId,correlation_id:e.correlationId}),o={info:{context:e.context}};return A.getToken().then(function(e){o.info.token=T.maskToken(T.get(e,"token.access_token")),A.refreshToken(e.token).then(function(){n.success(),t.resolve(o)},function(e){var r=e?T.getErrorCodesAndCategory(e):{};n.error(T.assign(o,{error_codes:r.codes||R.codes.READ_TOKEN_FAILURE.code,error_category:r.category||R.codes.READ_TOKEN_FAILURE.category})),t.reject(e)})},function(){n.error(T.assign(o,{error_codes:R.codes.READ_TOKEN_FAILURE.code,error_category:R.codes.READ_TOKEN_FAILURE.category})),t.resolve()}),t.promise}t.exports={configure:r,get:n,deleteInstance:i};var b,y,I,E,w,_,S=e("../components/outer/swid"),N=e("../../assets/common/js/q"),T=e("utils"),O=e("messages").getInstance(),k=e("../components/outer/environment"),A=e("../components/outer/session/session"),D=e("../components/common/event-emitter"),L=e("../components/inner/language-preferences/languages"),R=e("../components/metrics"),C=e("../components/outer/ui/do-not-disturb"),x=e("../components/outer/trust-state"),j=e("../components/common/trust-state/constants.js"),P=e("../components/outer/config"),B=e("../components/outer/progressive-profile-collection"),U=e("logger"),G=e("cookie"),F={},M=(R.actions,{}),H={NO_CONFIG_OPTIONS:"No configuration options provided",CONFIG_SET:"Configuration options have already been set",NO_CLIENT_ID:"clientId not provided",NO_RESPONDER_PAGE:"responderPage not provided",SESSION_ESTABLISHED:"Session already established",SESSION_NOT_ESTABLISHED:"Session not established",NOT_INITIALIZED:"Not initialized",ALREADY_INITIALIZED:"Already initialized",UNSUPPORTED_LOCALE:"Unsupported locale",NOT_IMPLEMENTED:"Not implemented",INVALID_ARGUMENT:"Invalid argument",FAILURE_BY_DESIGN:"FAILURE_BY_DESIGN",NOT_ENABLED:"Not enabled",NO_CALLBACK:"No Network Connect Callback URI passed",CALLBACK_MISMATCH:"Network Connect Callback URI does not match origin",INVALID_COOKIE_DOMAIN:"Provided cookieDomain is invalid",UNKNOWN_ERROR:"An unknown error occurred"};b=function(e){{var t=this;T.getOS()}e.outerDomain=window.location.hostname,k.init(e,I),R.setClientId(k.getClientId()),T.get(I,"modules.patchBay")&&I.modules.patchBay.init(k),T.get(I,"modules.trustStateWeb")&&(w=I.modules.trustStateWeb.init()),O.subscribe("session.loggedin",function(e,n){A.getGuest().then(function(e){S.write(e.token.swid,!0),t.emit("login",e),O.publish("readyToClose"),n&&n.resolve()})}),O.subscribe("apiEvent.ppu",function(e,t){O.publish("bridge.ppuSuccess"),t.resolve()}),O.subscribe("apiEvent.reauth",function(e,n){A.getGuest().then(function(e){t.emit("reauth",e),n.resolve()})}),O.subscribe("session.reestablished",function(){A.getGuest(!1,{context:"init"}).then(function(e){S.write(e.token.swid,!0)})}),O.subscribe("token.refreshed",function(e){U.info("token refreshed"),t.emit("refresh",e.token)}),O.subscribe("lightbox.hide",function(){t.emit("close")}),O.subscribe("guest.updated",function(e){t.emit("update",e)}),O.subscribe("profile.create",function(e){t.emit("create",e)}),O.subscribe("profile.deactivation-complete",function(){t.emit("logout")}),O.subscribe("session.deleted",function(e){var n=T.getCookie("SWID"),o={action_name:R.actions.event.logout+":"+e,anon:!1,swid:n};"undefined"==typeof _?R.send(o,!0):_.success(o),S.anonymize(),"accountdeactivated"!==e&&t.emit("logout"),k.setCorrelationId(T.uuid())}),O.subscribe("profile.primary-account",function(e){t.emit("primary-account",e)}),O.subscribe("marketing.opt-in",function(e){t.emit("opt-in",e)}),O.subscribe("license-plate-redeemed",function(){t.emit("license-plate-redeemed")}),O.subscribe("guest.trustStateChanged",function(e){e===j.STATES.low&&t.emit("low-trust")}),O.subscribe("metrics.actions.start",function(e){M[e.action]=e.ts}),F.initialized=!1,e.initialize&&t.init()},D.emittable(b),b.prototype.init=function(){var e,t=m({}),n=R.timed(R.actions.api.init,{correlation_id:t.correlationId,conversation_id:t.conversationId}),o=N.defer();if(F.initialized)o.reject(H.ALREADY_INITIALIZED),E.emit("error",H.ALREADY_INITIALIZED),n.success({error_codes:H.ALREADY_INITIALIZED});else{T.get(I,"modules")&&(I.modules.ui.init(k),e=I.modules.NativeClientSessionAdapter?new I.modules.NativeClientSessionAdapter:"https"===k.getProtocol()?new I.modules.SecureClientSessionAdapter:new I.modules.InsecureClientSessionAdapter),A.init(k,e),x.init();var r=function(e){A.getGuest(!1,{context:"init"}).then(function(e){o.resolve({loggedIn:!0,guest:e}),E.emit("init",{loggedIn:!0,guest:e}),n.success()},function(e){function r(){o.resolve({loggedIn:!0,guest:null}),E.emit("init",{loggedIn:!0,guest:null}),n.success({error_codes:"Logged in as unknown"})}T.containsErrorCode(e,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")?(U.debug("attempt to retrieve guest was made but access token was invalid or expired"),v({context:"init",correlation_id:t.correlationId}).then(function(e){U.debug("token refreh success; finishing initialization"),r()},function(e){T.containsErrorCode(e.error,"AUTHORIZATION_INVALID_REFRESH_TOKEN")&&setTimeout(function(e){U.error("access token invalid and token refresh failed - logging guest out"),O.publish("session.delete","init")},1e3),r()})):r()})},i=function(){S.anonymize({dontAnonymizeRealSwid:!0}),o.resolve({loggedIn:!1,guest:null}),E.emit("init",{loggedIn:!1,guest:null}),n.success()};I.isDirectFlow?o.resolve():A.getToken().then(r,i)["finally"](function(){U.info("OneID Initialized")}),F.initialized=!0}return o.promise},b.prototype.setLanguage=function(e){var t=N.defer();return L.isValid(e)?(F.locale=e,console.info(H.NOT_IMPLEMENTED)):(t.reject(H.UNSUPPORTED_LOCALE),E.emit("error",H.UNSUPPORTED_LOCALE)),t.promise},b.prototype.getConfig=function(){return T.clone(y)},b.prototype.getEditableProfileFields=function(e){e=m(e);var t=N.defer(),n=R.timed(R.actions.api.getEditableProfileFields,{conversation_id:e.conversationId,correlation_id:e.correlationId},e.conversationIdTimeStamp);return F.initialized?A.isLoggedIn().then(function(e){e?B.get().then(function(e){t.resolve(e),n.success()},function(){t.reject(H.UNKNOWN_ERROR),E.emit("error",H.UNKNOWN_ERROR),n.success({error_codes:H.UNKNOWN_ERROR})}):(t.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}):(t.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),t.promise},b.prototype.setEditableProfileFields=function(e,t){var n=m(t),o=n.conversationIdTimeStamp,r=R.timed(R.actions.api.setEditableProfileFields,{conversation_id:n.conversationId,correlation_id:n.correlationId},o),i=N.defer();return F.initialized?A.isLoggedIn().then(function(t){t?l("ppc-api",null,{guestData:e,conversation:{correlationId:n.correlationId}},!0).then(function(e){if(e.isUnresolvableError){var t=T.get(e,"output.failures[0].code",!0);i.reject(t),E.emit("error",t),r.success({error_codes:t})}else i.resolve(e.output),r.success()}):(i.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),r.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}):(i.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),r.success({error_codes:H.NOT_INITIALIZED})),i.promise},b.prototype.launchLogin=function(e){e=m(e);var t=R.timed(R.actions.api.launchLogin,{conversation_id:e.conversationId,correlation_id:e.correlationId},e.conversationIdTimeStamp),n=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(o){if(o)n.reject(H.SESSION_ESTABLISHED),E.emit("error",H.SESSION_ESTABLISHED),t.success({error_codes:H.SESSION_ESTABLISHED});else{var r=l("login","analytics-pageview",{conversation:{correlationId:e.correlationId},optionalConfigs:e.optionalConfigs});O.publish("lightbox.show","login",n),N.all([r,n.promise]).then(function(){t.success()},function(e){t.error({error_codes:e||"UNKNOWN_ERROR"})})}}):(n.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),t.success({error_codes:H.NOT_INITIALIZED})),n.promise},b.prototype.logout=function(){var e=m({});_=R.timed(R.actions.api.logout,{correlation_id:e.correlationId,conversation_id:e.conversationId});var t=N.defer(),n=N.defer();return A.isLoggedIn().then(function(e){var o=G.read("SWID");O.publish("session.delete","api",n),n.promise.then(function(){e?(t.resolve(),_.success({anon:!1,swid:o})):(t.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),_.success({anon:!1,error_codes:H.SESSION_NOT_ESTABLISHED,swid:o}))})}),t.promise},b.prototype.launchRegistration=function(e){e=m(e);var t=N.defer(),n=R.timed(R.actions.api.launchRegistration,{conversation_id:e.conversationId,correlation_id:e.correlationId},e.conversationIdTimeStamp);O.publish("lightbox.requestShowErrorOnFatal");var o={optionalConfigs:f(e),conversation:{correlationId:e.correlationId}};return T.get(o,"optionalConfigs.providedProfile.region")&&(o.optionalConfigs.providedProfile.region=o.optionalConfigs.providedProfile.region.toUpperCase()),F.initialized?A.isLoggedIn().then(function(e){if(e)t.reject(H.SESSION_ESTABLISHED),E.emit("error",H.SESSION_ESTABLISHED),n.success({error_codes:H.SESSION_ESTABLISHED});else{var r=l("register",void 0,T.assign(o,{skipSocial:!0}));r.then(function(){t.resolve(),n.success()},function(e){t.reject(e),n.error({error_codes:e||"UNKNOWN_ERROR"})})}}):(t.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),t.promise},b.prototype.launchSocialRegistration=function(e){e=m(e);var t=e.conversationIdTimeStamp,n=R.timed(R.actions.api.launchSocialRegistration,{conversation_id:e.conversationId,correlation_id:e.correlationId},t),o=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),e={optionalConfigs:f(e),conversation:{correlationId:e.correlationId}},T.get(e,"optionalConfigs.providedProfile.region")&&(e.optionalConfigs.providedProfile.region=e.optionalConfigs.providedProfile.region.toUpperCase()),F.initialized?A.isLoggedIn().then(function(t){if(t)o.reject(H.SESSION_ESTABLISHED),E.emit("error",H.SESSION_ESTABLISHED),n.success({error_codes:H.SESSION_ESTABLISHED});else{var r=l("register",void 0,e);r.then(function(){o.resolve(),n.success()},function(e){o.reject(e),n.error({error_codes:e||"UNKNOWN_ERROR"})})}}):(o.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),o.promise},b.prototype.launchProfile=function(e){e=m(e);var t=e.conversationIdTimeStamp,n=R.timed(R.actions.api.launchProfile,{conversation_id:e.conversationId,correlation_id:e.correlationId},t),o=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(t){if(t){var r=l("updateProfile",void 0,{conversation:{correlationId:e.correlationId}});r.then(function(){o.resolve(),n.success()},function(e){o.reject(e),n.error({error_codes:e||"UNKNOWN_ERROR"})})}else o.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED})}):(o.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),o.promise},b.prototype.launchNetworkConnect=function(e){e=m(e);var t=R.timed(R.actions.api.launchNetworkConnect,{conversation_id:e.conversationId,correlation_id:e.correlationId},e.conversationIdTimeStamp),n=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(o){if(o)if(void 0===e.networkConnectCallbackURI)n.reject(H.NO_CALLBACK),E.emit("error",H.NO_CALLBACK),t.success({error_codes:H.NO_CALLBACK});else if(0!==e.networkConnectCallbackURI.indexOf(window.location.protocol+"//"+window.location.hostname))n.reject(H.CALLBACK_MISMATCH),E.emit("error",H.CALLBACK_MISMATCH),t.success({error_codes:H.CALLBACK_MISMATCH});else{var r=N.defer();d("network-connect",e,r),r.promise.then(function(){O.publish("lightbox.show","network-connect",n)}),N.all([r.promise,n.promise]).then(function(){t.success()},function(e){t.error({error_codes:e||"UNKNOWN_ERROR"})})}else n.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),t.success({error_codes:H.SESSION_NOT_ESTABLISHED})}):(n.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),t.success({error_codes:H.NOT_INITIALIZED})),n.promise},b.prototype.launchResetPassword=function(e){e=m(e);var t=R.timed(R.actions.api.launchResetPassword,{correlation_id:e.correlationId,conversation_id:e.conversationId},e.conversationIdTimeStamp),n=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(o){o?(n.reject(H.SESSION_ESTABLISHED),E.emit("error",H.SESSION_ESTABLISHED),t.success({error_codes:H.SESSION_ESTABLISHED})):l("recover-password",null,{conversation:{correlationId:e.correlationId},fromAPI:!0}).then(function(){n.resolve(),t.success()}).fail(function(e){n.reject(e),E.emit("error",e),t.error({error_codes:e||"UNKNOWN_ERROR"})})}):(n.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),t.success({error_codes:H.NOT_INITIALIZED})),n.promise},b.prototype.launchRecoverUsername=function(e){e=m(e);var t=e.conversationIdTimeStamp,n=N.defer(),o=R.timed(R.actions.api.launchRecoverUsername,{conversation_id:e.conversationId,correlation_id:e.correlationId},t);return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(t){t?(n.reject(H.SESSION_ESTABLISHED),E.emit("error",H.SESSION_ESTABLISHED),o.success({error_codes:H.SESSION_ESTABLISHED})):l("recover-username",null,{conversation:{correlationId:e.correlationId},fromAPI:!0}).then(function(){n.resolve(),o.success()}).fail(function(e){n.reject(e),E.emit("error",e),o.error({error_codes:e||"UNKNOWN_ERROR"})})}):(n.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),o.success({error_codes:H.NOT_INITIALIZED})),n.promise},b.prototype.launchReauth=function(e){e=m(e);var t=e.conversationIdTimeStamp,n=R.timed(R.actions.api.launchReauth,{conversation_id:e.conversationId,correlation_id:e.correlationId},t),o=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?(A.isLoggedIn().then(function(t){if(t){var r={conversation:{correlationId:e.correlationId},isStandalone:!0},i=O.subscribe("session.reauth",function(){i(),A.getGuest().then(o.resolve.bind(o))});l("reauth",null,r).then(function(){n.success()},function(e){
o.reject(e),n.error({error_codes:e||"UNKNOWN_ERROR"})})}else o.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED})}),o.promise):(o.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED}),o.promise)},b.prototype.getGuest=function(e){var t=m({}),n=N.defer(),o=R.timed(R.actions.api.getGuest,{conversation_id:t.conversationId,correlation_id:t.correlationId,info:{session:A.getState(),force:"undefined"!=typeof e&&e}});return A.getGuest(e,{context:"getGuest"}).then(function(e){o.success(),n.resolve(e)},function(e){var r=e?T.getErrorCodesAndCategory(e):{};o.error({error_codes:r.codes||R.codes.SESSION_NOT_ESTABLISHED.code,error_category:r.category||R.codes.SESSION_NOT_ESTABLISHED.category}),T.containsErrorCode(e,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")?v(T.extend({context:"getGuest"},t)).then(function(){n.reject()},function(e){T.containsErrorCode(e.error,"AUTHORIZATION_INVALID_REFRESH_TOKEN")&&setTimeout(function(){O.publish("session.delete","getguest")},1e3)}):n.reject(e)}),n.promise},b.prototype.getLoggedInStatus=function(){var e=m(),t=N.defer(),n=R.timed(R.actions.api.getLoggedInStatus,{conversation_id:e.conversationId,correlation_id:e.correlationId});return A.isLoggedIn().then(function(){t.resolve.apply(t,arguments),n.success()}),t.promise},b.prototype.doNotDisturb=function(e){var t=m({}),n=N.defer(),o=R.timed(R.actions.api.setDoNotDisturb,{conversation_id:t.conversationId,correlation_id:t.correlationId});return void 0===e?(n.reject(H.INVALID_ARGUMENT),E.emit("error",H.INVALID_ARGUMENT),o.success({error_codes:H.INVALID_ARGUMENT})):A.isLoggedIn().then(function(t){t?(C.setState(e),e||g(),o.success()):(n.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),o.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}),n.promise},b.prototype.redeemLicensePlateCode=function(e){var t=m({}),n=(Date.now(),R.timed(R.actions.api.redeemLicensePlateCode,{correlation_id:t.correlationId,conversation_id:t.conversationId})),o=N.defer();return F.initialized?A.isLoggedIn().then(function(t){t?e?l("license-plate","analytics-link",{activationCode:e,fromRedeemAPI:!0},!0).then(function(e){e=e||{},e.errors&&e.errors.isActionableInputError?(o.reject("INVALID_VALUE"),E.emit("error","INVALID_VALUE"),n.success({error_codes:"INVALID_VALUE"})):e.errors?(o.reject("UNKNOWN_ERROR"),E.emit("error","UNKNOWN_ERROR"),n.error({error_codes:"UNKNOWN_ERROR"})):(o.resolve(),n.success())}).fail(function(e){o.reject(e),E.emit("error",e),n.error({error_codes:e||"UNKNOWN_ERROR"})}):(o.reject(H.INVALID_ARGUMENT),E.emit("error",H.INVALID_ARGUMENT),n.success({error_codes:H.INVALID_ARGUMENT})):(o.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}):(o.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),o.promise},b.prototype.forceTokenRefresh=function(){var e=m({}),t=R.timed(R.actions.api.forceTokenRefresh,{conversation_id:e.conversationId,correlation_id:e.correlationId}),n=N.defer();return A.isLoggedIn().then(function(e){e?A.getToken().then(function(e){O.publish("guest.tokenrefresh",e.token,n)},n.reject.bind(n)):(n.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),t.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}),n.promise.then(function(){t.success()},function(e){var n=T.get(e,"error.keyCategory")||"",o=-1===["UNKNOWN_ERROR","SYSTEM_UNAVAILABLE"].indexOf(n),r=[];(T.get(e,"error.errors")||[]).forEach(function(e){-1===r.indexOf(e.code)&&r.push(e.code)}),t.send({error_category:n,error_codes:r.join(",")},o)}),n.promise},b.prototype.launchDisplayName=function(e){e=m(e);var t=e.conversationIdTimeStamp,n=R.timed(R.actions.api.launchDisplayName,{conversation_id:e.conversationId,correlation_id:e.correlationId},t),o=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(t){t?P.getSite().then(function(t){if((t.displayName||{}).enabled){var r=l("updateDisplayName","prompt-reauth-if-low-trust",{conversation:{correlationId:e.correlationId}});O.publish("lightbox.show","updateDisplayName",o),r.then(function(){o.resolve(),n.success()},function(e){o.resolve(e),n.error({error_codes:e||"UNKNOWN_ERROR"})})}else o.reject(H.NOT_ENABLED),E.emit("error",H.NOT_ENABLED),n.success({error_codes:H.NOT_ENABLED})}):(o.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}):(o.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),o.promise},b.prototype.launchNewsletters=function(e,t){t=m(t);var n=t.conversationIdTimeStamp,o=R.timed(R.actions.api.launchNewsletters,{conversation_id:t.conversationId,correlation_id:t.correlationId},n),r=N.defer();return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?e?l("marketingOptIn","get-logged-in-status",{promotionId:e,sourceName:t&&t.sourceName||null,conversation:{correlationId:t.correlationId},pageName:"create-nrt"}).then(function(){r.resolve(),o.success()},function(e){r.reject(e),o.error({error_codes:e||"UNKNOWN_ERROR"})}):(r.reject(H.INVALID_ARGUMENT),o.success({error_codes:H.INVALID_ARGUMENT})):(r.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),o.success({error_codes:H.NOT_INITIALIZED})),r.promise},b.prototype.getGuestNewsletters=function(){var e=m({}),t=N.defer(),n=R.timed(R.actions.api.getGuestNewsletters,{conversation_id:e.conversationId,correlation_id:e.correlationId});return A.isLoggedIn().then(function(e){e?A.getGuest().then(function(e){t.resolve(e.marketing),n.success()}):(t.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}),t.promise},b.prototype.launchRequestActivity=function(e,t){var n=N.defer();t=m(t);var o=t.conversationIdTimeStamp,r=R.timed(R.actions.api.launchRequestActivity,{conversation_id:t.conversationId,correlation_id:t.correlationId},o);return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?A.isLoggedIn().then(function(o){if(o){var i=l("request-activity",void 0,{activityCode:e,opts:{correlationId:t.correlationId}});i.then(function(){n.resolve(),r.success()},function(e){n.reject(e),r.error({error_codes:e||"UNKNOWN_ERROR"})})}else n.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),r.success({error_codes:H.SESSION_NOT_ESTABLISHED})}):(n.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),r.success({error_codes:H.NOT_INITIALIZED})),n.promise},b.prototype.launchLicensePlate=function(e){var t=N.defer();e=m(e);var n=R.timed(R.actions.api.launchLicensePlate,{correlation_id:e.correlationId,conversation_id:e.conversationId},e.conversationIdTimeStamp);return O.publish("lightbox.requestShowErrorOnFatal"),F.initialized?l("license-plate","analytics-pageview",{conversation:{correlationId:e.correlationId}}).then(function(){t.resolve(),n.success()}).fail(function(e){t.reject(e),E.emit("error",e),R.error({error_codes:e||"UNKNOWN_ERROR"})}):(t.reject(H.NOT_INITIALIZED),E.emit("error",H.NOT_INITIALIZED),n.success({error_codes:H.NOT_INITIALIZED})),t.promise},b.prototype.getActivityStatus=function(e){var t=m({}),n=N.defer(),o=R.timed(R.actions.api.getActivityStatus,{conversation_id:t.conversationId,correlation_id:t.correlationId});return A.isLoggedIn().then(function(t){t?l("check-activity",null,{activityCode:e},!0).then(function(e){e.error_code?n.reject(e.error_code):(n.resolve(e.approvalStatus),o.success())},function(e){n.reject(e);var t=e?T.getErrorCodesAndCategory(e):{};o.error({error_codes:t.codes||R.codes.UNKNOWN.code,error_category:t.category||R.codes.UNKNOWN.category})}):(n.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),o.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}),n.promise},b.prototype.getTrustStateStatus=function(){var e=N.defer(),t=m({}),n=R.timed(R.actions.api.getTrustStateStatus,{conversation_id:t.conversationId,correlation_id:t.correlationId});return A.isLoggedIn().then(function(t){t?x.get().then(function(t){e.resolve(t.state),n.success()}):(e.reject(H.SESSION_NOT_ESTABLISHED),E.emit("error",H.SESSION_NOT_ESTABLISHED),n.success({error_codes:H.SESSION_NOT_ESTABLISHED}))}),e.promise},b.prototype.setDebug=function(e,t){if(e===!1)O.publish("debug.clear");else{var n=T.get(e,"geoIP");n&&O.publish("debug.geoIP",n);var o=T.get(e,"country");o&&O.publish("debug.country",o);var r=T.get(e,"metricsUrl");r&&R.setWebLogUrl(r)}"CLIENT_CONFIG"!==t||/-PROD$/.test(k.getClientId())||h(e)},b.prototype.setLogLevel=function(e,t){U.setLogLevel(e),O.publish("setLogLevel",{level:e}),t&&"OFF"!==e.toUpperCase()?G.write("oid_loglevel",e,null,"/"):t&&"OFF"!==e.toUpperCase()||G.remove("oid_loglevel",null,"/")},function(){var e=N.defer();O.subscribe("inner.fatal",function(){e.resolve()}),O.subscribe("lightbox.requestShowErrorOnFatal",function(){e.promise.then(function(){O.publish("lightbox.show")})})}()}()},{"../../assets/common/js/q":1,"../components/common/event-emitter":10,"../components/common/trust-state/constants.js":24,"../components/inner/language-preferences/languages":33,"../components/metrics":38,"../components/outer/config":47,"../components/outer/environment":48,"../components/outer/progressive-profile-collection":56,"../components/outer/session/session":63,"../components/outer/swid":64,"../components/outer/trust-state":66,"../components/outer/ui/do-not-disturb":68,cookie:6,logger:12,messages:13,utils:30}],72:[function(e,t,n){!function(){"use strict";function t(){function e(){var e=document&&document.querySelectorAll&&document.querySelectorAll("script")||[],t=e[e.length-1];return t&&t.getAttribute&&t.getAttribute("src")||""}g.randomChance(.004)&&f({action_name:d.actions.event.preinit,timestamp:(new Date).toISOString(),appid:"DTSS-DISNEYID-UI",info:g.formatLogInfoBlock({disneyid_js_url:e(),page_url:window&&window.location&&window.location.href,log_type:"preinit"})},!1)}e("../components/common/polyfills/console");var n="2.18.7",o=e("./api"),r=e("../components/outer/patch-bay"),i=e("../components/outer/ui/web-ui"),s=e("../components/outer/session/secure-client-session-adapter"),a=e("../components/outer/session/insecure-client-session-adapter"),c=e("../components/outer/s2-cookie"),u=e("../components/outer/session/guest/web/message-handlers"),l=e("../components/outer/trust-state/web.js"),d=e("metrics"),f=e("../components/metrics/requests/web"),p=e("logger"),g=e("utils"),h=e("cookie"),m=g.getOS();p.setLogLevel(h.read("oid_loglevel")||"INFO"),d.init({os:m.name?m.name+" "+m.version:m,sdk_version:"Web "+n,appid:"DTSS-DISNEYID-UI"},f),d.attachSubscribers(),o.configure({modules:{patchBay:r,ui:i,SecureClientSessionAdapter:s,InsecureClientSessionAdapter:a,trustStateWeb:l}}),c.init(),u.init(),window.DisneyID={get:function(e){return o.get(e)}},t()}()},{"../components/common/polyfills/console":15,"../components/metrics/requests/web":41,"../components/outer/patch-bay":55,"../components/outer/s2-cookie":58,"../components/outer/session/guest/web/message-handlers":60,"../components/outer/session/insecure-client-session-adapter":61,"../components/outer/session/secure-client-session-adapter":62,"../components/outer/trust-state/web.js":67,"../components/outer/ui/web-ui":69,"./api":71,cookie:6,logger:12,metrics:38,utils:30}]},{},[72,57,46]);
//# sourceMappingURL=DisneyID.js.map